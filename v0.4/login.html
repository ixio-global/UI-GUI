<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ixi-O Global Admin – 로그인/OTP/비밀번호 재설정</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }

    :root {
      --bg-body: #f4f4ff;
      --text-main: #111827;
      --text-sub: #4b5563;
      --text-muted: #6b7280;
      --text-error: #b91c1c;

      --brand-grad-from: #ff46a5;
      --brand-grad-to: #4f46e5;

      --surface: #ffffff;
      --surface-soft: #f9fafb;

      --border-default: #e5e7eb;
      --border-focus: #6366f1;
      --border-error: #ef4444;

      --btn-primary-bg: #111827;
      --btn-primary-bg-hover: #111827;
      --btn-disabled-bg: #e5e7eb;
      --btn-disabled-text: #9ca3af;

      --otp-border: #d1d5db;
      --otp-border-focus: #6366f1;
      --otp-border-error: #ef4444;

      --overlay-bg: rgba(15, 23, 42, 0.65);
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Noto Sans KR", system-ui, sans-serif;
      background: var(--bg-body);
      color: var(--text-main);
    }

    .auth-root {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .auth-wrapper {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px 16px;
    }

    .auth-shell {
      display: flex;
      max-width: 1120px;
      width: 100%;
      min-height: 540px;
      border-radius: 24px;
      overflow: hidden;
      background: var(--surface);
      box-shadow: 0 18px 45px rgba(148, 163, 184, 0.4);
    }

    /* 좌측 비주얼 영역 */
    .auth-visual {
      flex: 1.05;
      position: relative;
      background: radial-gradient(circle at 0 0, #ffe5f3 0, transparent 50%),
                  radial-gradient(circle at 100% 100%, #e0f2fe 0, transparent 55%),
                  linear-gradient(135deg, var(--brand-grad-from), var(--brand-grad-to));
    }
    .auth-visual-inner {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .auth-logo-box {
      text-align: left;
      color: #ffffff;
      padding: 32px 40px;
    }
    .auth-logo-main {
      font-size: 38px;
      font-weight: 800;
      letter-spacing: 0.06em;
      margin-bottom: 6px;
    }
    .auth-logo-sub {
      font-size: 16px;
      opacity: 0.9;
    }

    /* 우측 카드 */
    .auth-panel {
      flex: 1;
      padding: 40px 56px;
      display: none;
    }
    .auth-panel.active {
      display: block;
    }

    .auth-title {
      font-size: 24px;
      font-weight: 700;
      margin: 12px 0 26px;
      text-align: left;
    }

    .auth-form {
      max-width: 380px;
    }

    .field-group {
      margin-bottom: 18px;
    }
    .field-label-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
      font-size: 13px;
    }
    .field-label {
      font-weight: 500;
      color: var(--text-sub);
    }

    .input-wrap {
      position: relative;
    }
    .text-input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border-default);
      background: #f9fafb;
      font-size: 14px;
      outline: none;
      color: var(--text-main);
    }
    .text-input::placeholder {
      color: var(--text-muted);
    }
    .text-input:focus {
      border-color: var(--border-focus);
      box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.18);
      background: #ffffff;
    }

    .input-wrap.error .text-input {
      border-color: var(--border-error);
      box-shadow: 0 0 0 1px rgba(248, 113, 113, 0.18);
      background: #fef2f2;
    }

    .input-clear-btn {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: none;
      background: #e5e7eb;
      color: #374151;
      font-size: 12px;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 0;
    }
    .input-clear-btn.visible {
      display: inline-flex;
    }

    .field-error {
      margin-top: 4px;
      font-size: 12px;
      color: var(--text-error);
      min-height: 16px;
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
      font-size: 13px;
      color: var(--text-sub);
    }
    input[type="checkbox"] {
      width: 14px;
      height: 14px;
      accent-color: #4f46e5;
    }

    .btn-primary {
      width: 100%;
      padding: 11px 14px;
      margin-top: 16px;
      border-radius: 10px;
      border: none;
      background: var(--btn-primary-bg);
      color: #ffffff;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: background 0.15s ease-out, transform 0.05s ease-out;
    }
    .btn-primary:hover:not(:disabled) {
      background: var(--btn-primary-bg-hover);
      transform: translateY(-0.5px);
    }
    .btn-primary:disabled {
      background: var(--btn-disabled-bg);
      color: var(--btn-disabled-text);
      cursor: default;
    }

    .btn-secondary-link {
      border: none;
      background: transparent;
      color: var(--text-sub);
      font-size: 13px;
      padding: 0;
      cursor: pointer;
      text-decoration: underline;
      text-underline-offset: 2px;
    }
    .btn-secondary-link:hover {
      color: #4f46e5;
    }

    .auth-links-row {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
    }

    .auth-helper-text {
      margin-top: 24px;
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.6;
    }

    .common-error {
      margin-top: 12px;
      font-size: 13px;
      color: var(--text-error);
      min-height: 18px;
    }

    /* 비밀번호 재설정 */
    .hint-text {
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    /* OTP */
    .otp-wrapper {
      margin-top: 12px;
      margin-bottom: 6px;
      display: flex;
      gap: 10px;
    }
    .otp-input {
      width: 44px;
      height: 48px;
      text-align: center;
      font-size: 20px;
      border-radius: 10px;
      border: 1px solid var(--otp-border);
      background: #f9fafb;
      outline: none;
    }
    .otp-input:focus {
      border-color: var(--otp-border-focus);
      box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.18);
      background: #ffffff;
    }
    .otp-input.error {
      border-color: var(--otp-border-error);
      background: #fef2f2;
      box-shadow: 0 0 0 1px rgba(248, 113, 113, 0.18);
    }

    .qr-box {
      width: 140px;
      height: 140px;
      border-radius: 16px;
      background: #111827;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      color: #ffffff;
      font-size: 12px;
    }

    .otp-header {
      margin-bottom: 18px;
    }
    .otp-desc {
      font-size: 13px;
      color: var(--text-sub);
      line-height: 1.6;
      margin-top: 6px;
    }

    .link-back {
      margin-top: 16px;
      font-size: 13px;
      color: var(--text-sub);
      text-decoration: underline;
      text-underline-offset: 2px;
      cursor: pointer;
      display: inline-block;
    }
    .link-back:hover {
      color: #4f46e5;
    }

    /* OTP reset link spacing and appearance */
    .otp-reset-link {
      margin-top: 24px; /* increased space from confirm button */
      display: inline-block;
      padding: 0;
      color: var(--text-sub);
      text-decoration: underline;
      text-underline-offset: 2px;
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 13px;
    }
    .otp-reset-link:hover { color: #4f46e5; }

    /* 푸터 */
    .auth-footer {
      padding: 16px 24px 24px;
      text-align: center;
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.6;
    }

    /* 모달 */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: var(--overlay-bg);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .modal-overlay.active {
      display: flex;
    }
    .modal {
      background: #ffffff;
      border-radius: 16px;
      padding: 22px 22px 18px;
      max-width: 360px;
      width: 100%;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.45);
    }
    .modal-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 10px;
    }
    .modal-body {
      font-size: 13px;
      color: var(--text-sub);
      line-height: 1.6;
      margin-bottom: 18px;
    }
    .modal-footer {
      text-align: right;
    }
    .modal-btn {
      padding: 8px 16px;
      border-radius: 10px;
      border: none;
      background: #111827;
      color: #ffffff;
      font-size: 13px;
      cursor: pointer;
    }

    body.modal-open {
      overflow: hidden;
    }

    /* 반응형 */
    @media (max-width: 960px) {
      .auth-shell {
        flex-direction: column;
        max-width: 440px;
        min-height: auto;
      }
      .auth-visual {
        min-height: 180px;
      }
      .auth-visual-inner {
        justify-content: flex-start;
      }
      .auth-logo-box {
        padding: 24px;
      }
      .auth-panel {
        padding: 28px 24px 32px;
      }
      .auth-form {
        max-width: 100%;
      }
      .otp-wrapper {
        justify-content: space-between;
      }
      .otp-input {
        flex: 1;
      }
    }
  </style>
</head>
<body>
  <div class="auth-root">
    <div class="auth-wrapper">
      <div class="auth-shell">
        <!-- 좌측 비주얼 -->
        <aside class="auth-visual">
          <div class="auth-visual-inner">
            <div class="auth-logo-box">
              <div class="auth-logo-main">ixi-O</div>
              <div class="auth-logo-sub">Global Admin Console</div>
            </div>
          </div>
        </aside>

        <!-- 로그인 화면 -->
        <section class="auth-panel active" id="screen-login">
          <h1 class="auth-title">사용자 계정 로그인</h1>
          <form class="auth-form" id="form-login" novalidate>
            <!-- 아이디 -->
            <div class="field-group">
              <div class="field-label-row">
                <label class="field-label" for="login-email">아이디</label>
              </div>
              <div class="input-wrap" id="wrap-login-email">
                <input
                  id="login-email"
                  class="text-input"
                  type="email"
                  autocomplete="username"
                  placeholder="아이디를 입력하세요"
                />
              </div>
              <div class="checkbox-row">
                <input type="checkbox" id="login-remember" />
                <label for="login-remember">아이디 저장</label>
              </div>
              <p class="field-error" id="error-login-email"></p>
            </div>

            <!-- 비밀번호 -->
            <div class="field-group">
              <div class="field-label-row">
                <label class="field-label" for="login-password">비밀번호</label>
              </div>
              <div class="input-wrap" id="wrap-login-password">
                <input
                  id="login-password"
                  class="text-input"
                  type="password"
                  autocomplete="current-password"
                  placeholder="비밀번호를 입력하세요"
                />
                <button
                  type="button"
                  class="input-clear-btn"
                  id="btn-clear-password"
                  aria-label="비밀번호 지우기"
                >×</button>
              </div>
              <p class="field-error" id="error-login-password"></p>
            </div>

            <!-- 공통 에러 메시지 -->
            <div class="common-error" id="login-common-error"></div>

            <!-- 로그인 버튼 -->
            <button class="btn-primary" type="submit" id="btn-login" disabled>
              <span id="login-btn-label">로그인</span>
            </button>

            <!-- 링크 / 안내 -->
            <div class="auth-links-row">
              <button
                type="button"
                class="btn-secondary-link"
                id="link-go-reset"
              >
                비밀번호 재설정
              </button>
            </div>

            <p class="auth-helper-text">
              아이디 / 비밀번호 찾기 문의 : <strong>ixio-support@lguplus.co.kr</strong>
            </p>
          </form>
        </section>

        <!-- 비밀번호 재설정 화면 -->
        <section class="auth-panel" id="screen-reset">
          <h1 class="auth-title">비밀번호 재설정</h1>
          <form class="auth-form" id="form-reset" novalidate>
            <!-- 아이디 -->
            <div class="field-group">
              <div class="field-label-row">
                <label class="field-label" for="reset-email">아이디</label>
              </div>
              <div class="input-wrap" id="wrap-reset-email">
                <input
                  id="reset-email"
                  class="text-input"
                  type="email"
                  autocomplete="username"
                  placeholder="재설정할 아이디를 입력하세요"
                />
              </div>
              <p class="field-error" id="error-reset-email"></p>
            </div>

            <!-- 새 비밀번호 -->
            <div class="field-group">
              <div class="field-label-row">
                <label class="field-label" for="reset-password">비밀번호</label>
              </div>
              <div class="input-wrap" id="wrap-reset-password">
                <input
                  id="reset-password"
                  class="text-input"
                  type="password"
                  autocomplete="new-password"
                  placeholder="영문, 숫자, 특수문자가 포함된 8~20자로 입력하세요"
                />
              </div>
              <p class="hint-text">
                영문, 숫자, 특수문자를 모두 포함한 8~20자 조합으로 설정해야 합니다.
              </p>
              <p class="field-error" id="error-reset-password"></p>
            </div>

            <!-- 비밀번호 확인 -->
            <div class="field-group">
              <div class="field-label-row">
                <label class="field-label" for="reset-password-confirm">비밀번호 확인</label>
              </div>
              <div class="input-wrap" id="wrap-reset-password-confirm">
                <input
                  id="reset-password-confirm"
                  class="text-input"
                  type="password"
                  autocomplete="new-password"
                  placeholder="비밀번호를 한번 더 입력하세요"
                />
              </div>
              <p class="field-error" id="error-reset-password-confirm"></p>
            </div>

            <!-- 공통 에러 / 안내 -->
            <div class="common-error" id="reset-common-error"></div>

            <!-- 확인 버튼 -->
            <button class="btn-primary" type="submit" id="btn-reset" disabled>
              확인
            </button>

            <button
              type="button"
              class="link-back"
              id="link-back-login-from-reset"
            >
              이전 화면으로 가기
            </button>
          </form>
        </section>

        <!-- OTP 설정 / 2차 인증 화면 -->
        <section class="auth-panel" id="screen-otp">
          <div class="auth-form">
            <div class="otp-header">
              <h1 class="auth-title" style="margin-bottom:6px;">OTP 설정</h1>
              <p class="otp-desc">
                Google Authenticator를 사용해 QR 코드를 스캔하세요.<br />
                OTP 설정 완료 후 인증번호를 입력하세요.
              </p>
            </div>

            <div class="field-group">
              <div class="field-label-row">
                <span class="field-label">QR 코드</span>
              </div>
              <div class="qr-box">
                QR 코드 영역
              </div>
              <p class="hint-text">
                Google Authenticator 앱에서 &ldquo;QR 코드 스캔&rdquo;으로 계정을 등록하세요.
              </p>
            </div>

            <div class="field-group">
              <div class="field-label-row">
                <span class="field-label">인증번호 6자리</span>
              </div>
              <div class="otp-wrapper" id="otp-wrapper">
                <input class="otp-input" type="text" inputmode="numeric" maxlength="1" />
                <input class="otp-input" type="text" inputmode="numeric" maxlength="1" />
                <input class="otp-input" type="text" inputmode="numeric" maxlength="1" />
                <input class="otp-input" type="text" inputmode="numeric" maxlength="1" />
                <input class="otp-input" type="text" inputmode="numeric" maxlength="1" />
                <input class="otp-input" type="text" inputmode="numeric" maxlength="1" />
              </div>
              <p class="field-error" id="error-otp"></p>
            </div>

            <button class="btn-primary" type="button" id="btn-otp-confirm" disabled>
              확인
            </button>

            <button type="button" class="btn-secondary-link otp-reset-link" id="btn-otp-reset">
              OTP 재설정
            </button>
          </div>
        </section>
      </div>
    </div>

    <!-- 푸터 -->
    <footer class="auth-footer">
      ㈜엘지유플러스 서울특별시 용산구 한강대로 32 대표이사 황현식 &nbsp;|&nbsp;
      사업자등록번호 220-81-39938 &nbsp;|&nbsp;
      통신판매신고 제 2015-서울용산-00481호<br />
      Copyright ⓒ LG Uplus Corp. All Rights Reserved.
    </footer>
  </div>

  <!-- 계정 정지/잠금 안내 모달 -->
  <div class="modal-overlay" id="modal-account-status">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="modal-title" id="modal-title">안내</div>
      <div class="modal-body" id="modal-body">
        관리자에 의해 사용이 정지된 계정입니다.
      </div>
      <div class="modal-footer">
        <button type="button" class="modal-btn" id="modal-close-btn">확인</button>
      </div>
    </div>
  </div>

  <script>
    window.addEventListener("DOMContentLoaded", function () {
      const screens = {
        login: document.getElementById("screen-login"),
        reset: document.getElementById("screen-reset"),
        otp: document.getElementById("screen-otp"),
      };

      function showScreen(name) {
        Object.keys(screens).forEach((key) => {
          if (screens[key]) {
            screens[key].classList.toggle("active", key === name);
          }
        });
      }

      /* ========== 공통 유틸 ========== */
      function validateEmailFormat(value) {
        if (!value) return false;
        const pattern = /^[^@\s]+@[^@\s]+\.[^@\s]+$/;
        return pattern.test(value);
      }

      function setFieldError(errorEl, wrapId, message) {
        errorEl.textContent = message || "";
        const wrap = document.getElementById(wrapId);
        if (wrap) {
          if (message) wrap.classList.add("error");
          else wrap.classList.remove("error");
        }
      }
      function clearFieldError(errorEl, wrapId) {
        setFieldError(errorEl, wrapId, "");
      }

      /* ========== 계정 상태 모달 ========== */
      const modalOverlay = document.getElementById("modal-account-status");
      const modalBody = document.getElementById("modal-body");
      const modalCloseBtn = document.getElementById("modal-close-btn");

      function showAccountStatusModal(type, message) {
        modalBody.textContent = message;
        modalOverlay.classList.add("active");
        document.body.classList.add("modal-open");
        modalCloseBtn.focus();
      }
      function closeAccountStatusModal() {
        modalOverlay.classList.remove("active");
        document.body.classList.remove("modal-open");
      }
      modalCloseBtn.addEventListener("click", closeAccountStatusModal);
      window.showAccountStatusModal = showAccountStatusModal;

      /* ========== 로그인 ========== */
      const loginEmail = document.getElementById("login-email");
      const loginPassword = document.getElementById("login-password");
      const loginBtn = document.getElementById("btn-login");
      const loginBtnLabel = document.getElementById("login-btn-label");
      const loginCommonError = document.getElementById("login-common-error");
      const loginEmailError = document.getElementById("error-login-email");
      const loginPasswordError = document.getElementById("error-login-password");
      const clearPasswordBtn = document.getElementById("btn-clear-password");
      let loginFailCount = 0;
      const MAX_LOGIN_FAIL = 5; // 잠금 전 최대 실패 횟수

      function updateLoginButtonState() {
        const hasValues =
          loginEmail.value.trim() !== "" && loginPassword.value.trim() !== "";
        loginBtn.disabled = !hasValues;
      }

      loginEmail.addEventListener("input", () => {
        clearFieldError(loginEmailError, "wrap-login-email");
        loginCommonError.textContent = "";
        updateLoginButtonState();
      });

      loginPassword.addEventListener("input", () => {
        clearFieldError(loginPasswordError, "wrap-login-password");
        loginCommonError.textContent = "";
        updateLoginButtonState();
        clearPasswordBtn.classList.toggle(
          "visible",
          loginPassword.value.length > 0
        );
      });

      clearPasswordBtn.addEventListener("click", () => {
        loginPassword.value = "";
        clearPasswordBtn.classList.remove("visible");
        updateLoginButtonState();
        loginPassword.focus();
      });

      function mockLoginResult(email, password) {
        // 계정 정지 예시: 이메일에 "suspended" 포함
        if (email.includes("suspended")) {
          return { status: "suspended" };
        }
        // 계정 해지 예시는 일반 오류로 처리 (화면 상 노출 없음)
        if (email.includes("terminated")) {
          return { status: "terminated" };
        }
        // 비밀번호를 "error"로 입력하면 실패 카운트 증가 → 잠금 유도
        if (password === "error") {
          loginFailCount += 1;
          if (loginFailCount >= MAX_LOGIN_FAIL) {
            return { status: "locked" };
          }
          return { status: "invalid" };
        }
        // 정상 로그인
        loginFailCount = 0;
        return { status: "ok" };
      }

      document
        .getElementById("form-login")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          loginCommonError.textContent = "";
          clearFieldError(loginEmailError, "wrap-login-email");
          clearFieldError(loginPasswordError, "wrap-login-password");

          const email = loginEmail.value.trim();
          const pwd = loginPassword.value.trim();

          if (!email) {
            setFieldError(loginEmailError, "wrap-login-email", "아이디를 입력하세요.");
          } else if (!validateEmailFormat(email)) {
            setFieldError(
              loginEmailError,
              "wrap-login-email",
              "이메일 형식이 올바르지 않습니다."
            );
          }

          if (!pwd) {
            setFieldError(
              loginPasswordError,
              "wrap-login-password",
              "비밀번호를 입력하세요."
            );
          }

          if (loginEmailError.textContent || loginPasswordError.textContent) {
            return;
          }

          // 로딩 상태
          loginBtn.disabled = true;
          loginBtnLabel.textContent = "로그인 중...";

          setTimeout(() => {
            const result = mockLoginResult(email, pwd);

            if (result.status === "ok") {
              loginCommonError.textContent = "";
              // OTP 입력 화면으로 전환
              resetOtpInputs();
              showScreen("otp");
            } else if (result.status === "suspended") {
              showAccountStatusModal(
                "정지",
                "관리자에 의해 사용이 정지된 계정입니다."
              );
              loginCommonError.textContent =
                "로그인에 실패했습니다. 관리자에게 문의해 주세요.";
            } else if (result.status === "locked") {
              showAccountStatusModal(
                "잠금",
                "비밀번호 입력 횟수 초과로 잠긴 계정입니다."
              );
              loginCommonError.textContent =
                "로그인에 실패했습니다. 관리자에게 문의해 주세요.";
            } else {
              // terminated 포함한 일반 오류
              loginCommonError.textContent =
                "아이디 또는 비밀번호가 올바르지 않습니다.";
            }

            loginBtnLabel.textContent = "로그인";
            updateLoginButtonState();
          }, 500);
        });

      /* ========== 비밀번호 재설정 ========== */
      const resetEmail = document.getElementById("reset-email");
      const resetPassword = document.getElementById("reset-password");
      const resetPasswordConfirm = document.getElementById(
        "reset-password-confirm"
      );
      const resetBtn = document.getElementById("btn-reset");
      const resetCommonError = document.getElementById("reset-common-error");
      const resetEmailError = document.getElementById("error-reset-email");
      const resetPasswordError = document.getElementById(
        "error-reset-password"
      );
      const resetPasswordConfirmError = document.getElementById(
        "error-reset-password-confirm"
      );

      function validatePasswordRule(value) {
        if (!value) return false;
        // 영문 + 숫자 + 특수문자, 8~20자
        const pattern =
          /^(?=.*[A-Za-z])(?=.*\d)(?=.*[ !"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~]).{8,20}$/;
        return pattern.test(value);
      }

      function updateResetButtonState() {
        const hasValues =
          resetEmail.value.trim() &&
          resetPassword.value.trim() &&
          resetPasswordConfirm.value.trim();
        resetBtn.disabled = !hasValues;
      }

      [resetEmail, resetPassword, resetPasswordConfirm].forEach((el) => {
        el.addEventListener("input", () => {
          resetCommonError.textContent = "";
          clearFieldError(resetEmailError, "wrap-reset-email");
          clearFieldError(resetPasswordError, "wrap-reset-password");
          clearFieldError(
            resetPasswordConfirmError,
            "wrap-reset-password-confirm"
          );
          updateResetButtonState();
        });
      });

      document
        .getElementById("form-reset")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          resetCommonError.style.color = "#b91c1c";
          resetCommonError.textContent = "";
          clearFieldError(resetEmailError, "wrap-reset-email");
          clearFieldError(resetPasswordError, "wrap-reset-password");
          clearFieldError(
            resetPasswordConfirmError,
            "wrap-reset-password-confirm"
          );

          const email = resetEmail.value.trim();
          const pwd = resetPassword.value.trim();
          const pwd2 = resetPasswordConfirm.value.trim();

          if (!email) {
            setFieldError(
              resetEmailError,
              "wrap-reset-email",
              "아이디를 입력하세요."
            );
          } else if (!validateEmailFormat(email)) {
            setFieldError(
              resetEmailError,
              "wrap-reset-email",
              "이메일 형식이 올바르지 않습니다."
            );
          }

          if (!pwd) {
            setFieldError(
              resetPasswordError,
              "wrap-reset-password",
              "비밀번호를 입력하세요."
            );
          } else if (!validatePasswordRule(pwd)) {
            setFieldError(
              resetPasswordError,
              "wrap-reset-password",
              "영문, 숫자, 특수문자를 모두 포함한 8~20자로 설정해야 합니다."
            );
          }

          if (!pwd2) {
            setFieldError(
              resetPasswordConfirmError,
              "wrap-reset-password-confirm",
              "비밀번호를 다시 입력하세요."
            );
          } else if (pwd && pwd2 && pwd !== pwd2) {
            setFieldError(
              resetPasswordConfirmError,
              "wrap-reset-password-confirm",
              "비밀번호가 일치하지 않습니다."
            );
          }

          if (
            resetEmailError.textContent ||
            resetPasswordError.textContent ||
            resetPasswordConfirmError.textContent
          ) {
            return;
          }

          // 성공 플로우: 비밀번호 변경 완료 → 로그인 화면으로 복귀
          resetCommonError.style.color = "#16a34a";
          resetCommonError.textContent =
            "비밀번호가 변경되었습니다. 새로운 비밀번호로 다시 로그인해 주세요.";

          setTimeout(() => {
            // 로그인 화면으로 이동하면서 아이디만 유지
            loginEmail.value = email;
            loginPassword.value = "";
            clearPasswordBtn.classList.remove("visible");
            loginCommonError.textContent = "";
            updateLoginButtonState();

            // 재설정 화면 초기화
            resetPassword.value = "";
            resetPasswordConfirm.value = "";
            updateResetButtonState();
            resetCommonError.textContent = "";

            showScreen("login");
            loginPassword.focus();
          }, 900);
        });

      /* ========== OTP ========== */
      const otpInputs = Array.from(
        document.querySelectorAll("#otp-wrapper .otp-input")
      );
      const otpError = document.getElementById("error-otp");
      const otpBtn = document.getElementById("btn-otp-confirm");

      function updateOtpButtonState() {
        const filled = otpInputs.every((el) => el.value.trim() !== "");
        otpBtn.disabled = !filled;
      }

      function resetOtpInputs() {
        otpInputs.forEach((i) => {
          i.value = "";
          i.classList.remove("error");
        });
        otpError.textContent = "";
        updateOtpButtonState();
        if (otpInputs[0]) otpInputs[0].focus();
      }

      otpInputs.forEach((input, index) => {
        input.addEventListener("input", (e) => {
          const value = e.target.value.replace(/\D/g, "");
          e.target.value = value.slice(0, 1);
          otpInputs.forEach((i) => i.classList.remove("error"));
          otpError.textContent = "";
          if (value && index < otpInputs.length - 1) {
            otpInputs[index + 1].focus();
          }
          updateOtpButtonState();
        });

        input.addEventListener("keydown", (e) => {
          if (e.key === "Backspace" && !e.target.value && index > 0) {
            otpInputs[index - 1].focus();
          }
        });
      });

      otpBtn.addEventListener("click", () => {
        const code = otpInputs.map((el) => el.value).join("");
        if (code.length < 6) return;

        // 데모 규칙:
        // 123456 → 성공
        // 000000 → 유효 시간 만료
        // 그 외 → 인증번호 오류
        otpInputs.forEach((i) => i.classList.remove("error"));
        otpError.textContent = "";

        if (code === "123456") {
          alert("로그인에 성공했습니다. 어드민 홈 화면으로 이동합니다. (데모)");
          // TODO: 실제 어드민 홈으로 redirect
        } else if (code === "000000") {
          otpInputs.forEach((i) => i.classList.add("error"));
          otpError.textContent = "인증 유효 시간이 만료되었습니다.";
        } else {
          otpInputs.forEach((i) => i.classList.add("error"));
          otpError.textContent = "인증 번호를 다시 확인해 주세요.";
        }
      });

      /* ========== 화면 전환 링크 ========== */
      document
        .getElementById("link-go-reset")
        .addEventListener("click", function () {
          resetEmail.value = loginEmail.value.trim();
          resetPassword.value = "";
          resetPasswordConfirm.value = "";
          resetCommonError.textContent = "";
          resetEmailError.textContent = "";
          resetPasswordError.textContent = "";
          resetPasswordConfirmError.textContent = "";
          updateResetButtonState();
          showScreen("reset");
          if (resetPassword) resetPassword.focus();
        });

      document
        .getElementById("link-back-login-from-reset")
        .addEventListener("click", function () {
          showScreen("login");
        });

      // OTP reset button (replaces previous 'back' link)
      const btnOtpReset = document.getElementById("btn-otp-reset");
      if (btnOtpReset) {
        btnOtpReset.addEventListener("click", function () {
          // Demo behavior: clear OTP inputs and show a message.
          otpInputs.forEach((i) => (i.value = ""));
          updateOtpButtonState();
          otpInputs[0] && otpInputs[0].focus();
          alert("OTP 재설정 요청이 접수되었습니다. (데모)");
          // In a real implementation, trigger an API call to reset/regenerate OTP here.
        });
      }

      // 초기 상태
      updateLoginButtonState();
      updateResetButtonState();
      updateOtpButtonState();
      showScreen("login");
    });
  </script>
</body>
</html>
