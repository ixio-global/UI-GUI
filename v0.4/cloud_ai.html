<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <title>Cloud AI 기능 관리</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        /* Base Styles from Template */
        * {
            box-sizing: border-box;
        }

        :root {
            /* Base */
            --bg-body: #f8fafc;
            --text-main: #0f172a;
            --text-sub: #334155;
            --text-muted: #64748b;
            --text-light: #94a3b8;

            /* Brand */
            --brand-grad-from: #172554;
            --brand-grad-to: #1e40af;
            --brand-main: #1e40af;
            --brand-main-dark: #1e3a8a;
            --brand-main-deep: #172554;

            /* Surface */
            --surface: #ffffff;
            --surface-soft: #f1f5f9;
            --border-soft: #e2e8f0;
            --border-input: #cbd5e1;
            --sidebar-bg: #ffffff;
            --sidebar-title: #64748b;
            --menu-text: #334155;
            --submenu-dot: #cbd5e1;

            /* Accents */
            --accent-chip-bg: #eff6ff;
            --accent-chip-bg-strong: #dbeafe;
            --accent-chip-text: #1e40af;
            --accent-hover: #f1f5f9;

            /* Buttons */
            --btn-primary-bg: #1e40af;
            --btn-primary-bg-hover: #1e3a8a;
            --btn-danger-border: #fca5a5;
            --btn-danger-text: #dc2626;
            --btn-danger-bg-hover: #fef2f2;

            /* Badges */
            --badge-green-bg: #dcfce7;
            --badge-green-text: #166534;
            --badge-red-bg: #fee2e2;
            --badge-red-text: #991b1b;
            --badge-blue-bg: #dbeafe;
            --badge-blue-text: #1e40af;

            --table-head-bg: #f8fafc;
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Noto Sans KR", system-ui, sans-serif;
            background: var(--bg-body);
            color: var(--text-main);
        }

        /* Header & Layout (Template) */
        .header {
            position: fixed;
            inset: 0 0 auto 0;
            height: 60px;
            padding: 0 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(90deg, var(--brand-grad-from), var(--brand-grad-to));
            color: #ffffff;
            z-index: 20;
            box-shadow: 0 4px 12px rgba(23, 37, 84, 0.4);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 80px;
        }

        .logo {
            font-weight: 800;
            font-size: 20px;
            letter-spacing: 0.04em;
        }

        .top-nav {
            display: flex;
            gap: 40px;
            font-size: 15px;
        }

        .top-nav-item {
            padding: 6px 10px;
            border-radius: 999px;
            cursor: pointer;
            opacity: 0.9;
            white-space: nowrap;
        }

        .top-nav-item:hover {
            background: rgba(255, 255, 255, 0.18);
            opacity: 1;
        }

        .top-nav-item.active {
            background: #ffffff;
            color: var(--brand-main-deep);
            font-weight: 600;
            opacity: 1;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.95);
            color: var(--brand-main);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .layout {
            display: flex;
            margin-top: 60px;
            min-height: calc(100vh - 60px);
        }

        .sidebar {
            width: 260px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border-soft);
            padding: 24px 16px;
            flex-shrink: 0;
        }

        .sidebar-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--sidebar-title);
            margin-bottom: 12px;
        }

        .menu-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 14px;
        }

        .menu-item {
            border-radius: 10px;
            color: var(--menu-text);
        }

        .menu-main {
            padding: 10px 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            border-radius: 10px;
        }

        .menu-main:hover {
            background: var(--accent-hover);
        }

        .menu-item.active>.menu-main {
            background: var(--brand-main);
            color: #ffffff;
            font-weight: 600;
        }

        .menu-label {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .menu-icon {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            background: var(--accent-chip-bg);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: var(--brand-main);
        }

        .menu-item.active .menu-icon {
            background: rgba(255, 255, 255, 0.22);
            color: #ffffff;
        }

        .menu-arrow {
            font-size: 12px;
            transition: transform 0.15s ease-out;
        }

        .menu-item.open .menu-arrow {
            transform: rotate(90deg);
        }

        .submenu-list {
            list-style: none;
            padding: 0;
            margin: 4px 0 4px 32px;
            display: none;
        }

        .menu-item.open .submenu-list {
            display: block;
        }

        .submenu-item {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 13px;
            color: var(--text-sub);
            cursor: pointer;
            position: relative;
        }

        .submenu-item::before {
            content: "";
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 3px;
            border-radius: 999px;
            background: var(--submenu-dot);
        }

        .submenu-item:hover {
            background: var(--accent-hover);
        }

        .submenu-item.active {
            background: var(--accent-chip-bg-strong);
            color: var(--brand-main-dark);
            font-weight: 600;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .submenu-item.active::before {
            background: var(--brand-main);
        }

        .main {
            flex: 1;
            padding: 24px 32px 32px;
            overflow: auto;
            background: var(--bg-body);
        }

        .breadcrumb {
            font-size: 14px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 10px;
        }

        .breadcrumb span.current {
            color: var(--text-main);
            font-weight: 600;
        }

        .page-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 18px;
            color: var(--text-main);
        }

        /* Card & UI Components */
        .card {
            background: var(--surface);
            border-radius: 14px;
            border: 1px solid var(--border-soft);
            padding: 20px 24px;
            margin-bottom: 20px;
            box-shadow: 0 6px 18px rgba(148, 163, 184, 0.08);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-main);
            margin: 0;
        }

        .card-desc {
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Buttons */
        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .btn-primary {
            background: var(--brand-main);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background: var(--brand-main-dark);
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.2);
        }

        .btn-secondary {
            background: white;
            border-color: var(--border-soft);
            color: var(--text-sub);
        }

        .btn-secondary:hover {
            background: var(--surface-soft);
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-sub);
            padding: 6px 10px;
        }

        .btn-ghost:hover {
            background: var(--surface-soft);
        }

        .btn-action-icon {
            padding: 4px;
            border-radius: 4px;
            color: var(--text-muted);
            cursor: pointer;
        }

        .btn-action-icon:hover {
            background: var(--surface-soft);
            color: var(--brand-main);
        }

        .btn-dimmed {
            opacity: 0.5;
            pointer-events: none;
        }

        .btn-group {
            display: flex;
            gap: 8px;
        }

        /* Select / Input */
        .select-input,
        .text-input {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border-input);
            font-size: 13px;
            color: var(--text-main);
            outline: none;
            transition: border-color 0.15s;
            appearance: none;
            background-color: white;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23334155' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
            /* Space for arrow */
        }

        .select-input:focus,
        .text-input:focus {
            border-color: var(--brand-main);
            box-shadow: 0 0 0 2px rgba(30, 64, 175, 0.1);
        }

        .w-full {
            width: 100%;
        }

        .w-sm {
            width: 200px;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-green {
            background: var(--badge-green-bg);
            color: var(--badge-green-text);
        }

        .badge-red {
            background: var(--badge-red-bg);
            color: var(--badge-red-text);
        }

        .badge-blue {
            background: var(--badge-blue-bg);
            color: var(--badge-blue-text);
        }

        .badge-gray {
            background: #f1f5f9;
            color: #64748b;
        }

        /* Function Chips */
        .chip-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .chip {
            padding: 6px 14px;
            border-radius: 999px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--border-soft);
            background: white;
            color: var(--text-sub);
            transition: all 0.2s;
        }

        .chip:hover {
            background: var(--surface-soft);
        }

        .chip.active {
            background: var(--brand-main);
            color: white;
            border-color: var(--brand-main);
            box-shadow: 0 4px 10px rgba(30, 64, 175, 0.3);
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .data-table th {
            background: var(--table-head-bg);
            color: var(--text-muted);
            font-weight: 600;
            text-align: left;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-soft);
            vertical-align: middle;
        }

        .data-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-soft);
            color: var(--text-sub);
            vertical-align: middle;
        }

        .data-table tr:hover td {
            background: var(--surface-soft);
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        /* Traffic Input */
        .traffic-input-group {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .traffic-input {
            width: 50px;
            text-align: right;
            border: 1px solid transparent;
            background: transparent;
            font-weight: 600;
            color: var(--text-main);
            font-size: 13px;
            padding: 4px;
            border-radius: 4px;
        }

        .traffic-input.editing {
            border-color: var(--brand-main);
            background: white;
        }

        .edit-icon {
            font-size: 12px;
            color: var(--text-muted);
            cursor: pointer;
            visibility: hidden;
        }

        .traffic-input-group:hover .edit-icon {
            visibility: visible;
        }

        .traffic-input:focus+.edit-icon {
            visibility: visible;
            color: var(--brand-main);
        }

        /* Modal */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 50;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(2px);
        }

        .modal-backdrop.open {
            display: flex;
        }

        .modal-panel {
            background: white;
            width: 600px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            animation: slideUp 0.2s ease-out;
        }

        .modal-lg {
            width: 800px;
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-soft);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-main);
            margin: 0;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--text-muted);
            cursor: pointer;
        }

        .modal-body {
            padding: 24px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border-soft);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: var(--bg-body);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Form Layout inside Modal */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .form-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-sub);
        }

        .form-control-box {
            border: 1px solid var(--border-soft);
            border-radius: 8px;
            padding: 16px;
            background: var(--surface-soft);
        }

        .toggle-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .toggle-switch {
            width: 36px;
            height: 20px;
            background: var(--border-input);
            border-radius: 99px;
            position: relative;
            cursor: pointer;
            transition: 0.2s;
        }

        .toggle-switch.on {
            background: var(--brand-main);
        }

        .toggle-switch::after {
            content: "";
            position: absolute;
            left: 2px;
            top: 2px;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            transition: 0.2s;
        }

        .toggle-switch.on::after {
            transform: translateX(16px);
        }

        /* Layout Grid for Modal */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* Helper */
        .text-red {
            color: var(--btn-danger-text);
        }

        .text-desc {
            font-size: 12px;
            color: var(--text-muted);
            line-height: 1.4;
        }

        /* Modal List Item Styles (Decoupled from Sidebar) */
        .list-item {
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-sub);
            transition: 0.2s;
        }

        .list-item:hover {
            background: var(--surface-soft);
        }

        .list-item.active {
            background: var(--accent-chip-bg);
            color: var(--brand-main);
            font-weight: 600;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="logo">ixi-O O&M</div>
            <nav class="top-nav">
                <div class="top-nav-item" data-top-label="상품 운영">상품 운영</div>
                <div class="top-nav-item active" data-top-label="서비스 운영">서비스 운영</div>
                <div class="top-nav-item" data-top-label="서비스 정산">서비스 정산</div>
                <div class="top-nav-item" data-top-label="일반">일반</div>
            </nav>
        </div>
        <div class="header-right">
            <div class="avatar">A</div>
            <span>관리자</span>
        </div>
    </header>

    <div class="layout">
        <aside class="sidebar">
            <div class="sidebar-section-title" id="sidebar-title">서비스 운영</div>
            <ul class="menu-list" id="sidebar-menu">
                <!-- Will be populated by JS -->
            </ul>
        </aside>

        <main class="main">
            <div class="breadcrumb" id="breadcrumb">
                <span>서비스 운영</span>
                <span>›</span>
                <span>DevOps</span>
                <span>›</span>
                <span class="current">Cloud AI 기능</span>
            </div>

            <div class="page-title">Cloud AI 기능</div>

            <!-- SECTION 1: Target & Function Selection -->
            <div class="card">
                <div class="card-header">
                    <div>
                        <h3 class="card-title">타겟 기업 / 기능 선택</h3>
                        <p class="card-desc">타겟 기업과 기능 구분을 선택해 해당 컨텍스트 내의 On-device 모델 목록과 상세 설정을 관리합니다.</p>
                    </div>
                </div>
                <div class="grid-2">
                    <div>
                        <div class="form-label">타겟 기업</div>
                        <div style="margin-top: 8px;">
                            <input type="text" class="text-input w-full" value="Maxis" readonly
                                style="background: var(--bg-body); cursor: default;" />
                        </div>
                        <p class="text-desc" style="margin-top: 4px;">이 화면에서 수행하는 모든 조회·등록·배포·수정 등은 선택된 기업 컨텍스트
                            내에서만
                            반영됩니다.</p>
                    </div>
                    <div>
                        <div class="form-label">기능 구분</div>
                        <div class="chip-group" style="margin-top: 8px;">
                            <div class="chip active">요약 (Summary)</div>
                            <div class="chip">번역 (Translate, 예시)</div>
                            <div class="chip">분류 (Classify, 예시)</div>
                        </div>
                        <p class="text-desc" style="margin-top: 4px;">기능별로 별도 트래픽 비율을 운영합니다. 향후 기능 구분이 확장됩니다.
                        </p>
                    </div>
                </div>
            </div>



            <!-- SECTION 1 (Cont): AI Model List -->
            <div class="card">
                <div class="card-header">
                    <div>
                        <h3 class="card-title">AI 모델 목록</h3>
                        <p class="card-desc">선택한 기업과 기능 구분 기준으로 등록된 On-device AI 모델과 트래픽 비율을 관리합니다.</p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-secondary btn-dimmed" id="btn-apply-ratio">트래픽 비율 적용</button>
                        <button class="btn btn-primary" onclick="openModal('modal-register')">신규 등록</button>
                    </div>
                </div>

                <table class="data-table">
                    <colgroup>
                        <col style="width: 10%" />
                        <col style="width: 10%" />
                        <col style="width: 22%" />
                        <col style="width: 8%" />
                        <col style="width: 8%" />
                        <col style="width: 12%" />
                        <col style="width: 15%" />
                        <col style="width: 10%" />
                        <col style="width: 5%" />
                    </colgroup>
                    <thead>
                        <tr>
                            <th>기업</th>
                            <th>기능 구분</th>
                            <th>모델명</th>
                            <th class="text-center">적용 여부</th>
                            <th class="text-center">데이터 수집</th>
                            <th class="text-right">트래픽 비율</th>
                            <th class="text-center">최종 수정일</th>
                            <th class="text-center">수정자</th>
                            <th class="text-center">더보기</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Group Row 1 -->
                        <tr>
                            <td rowspan="2" style="font-weight: 600;">Maxis</td>
                            <td rowspan="2">요약</td>
                            <td>Gemini 2.5 Flash</td>
                            <td class="text-center"><span class="badge badge-green">적용중</span></td>
                            <td class="text-center"><span class="badge badge-blue">수집</span></td>
                            <td class="text-right">
                                <div class="traffic-input-group" style="justify-content: flex-end;">
                                    <input type="text" class="traffic-input" value="80%" onfocus="enableRatioEdit(this)"
                                        onblur="formatRatio(this)" />
                                    <span class="edit-icon">✎</span>
                                </div>
                            </td>
                            <td class="text-center">2025-11-20 10:15</td>
                            <td class="text-center">김유플</td>
                            <td class="text-center"><button class="btn-ghost btn-action-icon">⋯</button></td>
                        </tr>
                        <!-- Group Row 2 -->
                        <tr>
                            <td>GPT 5.1</td>
                            <td class="text-center"><span class="badge badge-green">적용중</span></td>
                            <td class="text-center"><span class="badge badge-red">미수집</span></td>
                            <td class="text-right">
                                <div class="traffic-input-group" style="justify-content: flex-end;">
                                    <input type="text" class="traffic-input" value="20%" onfocus="enableRatioEdit(this)"
                                        onblur="formatRatio(this)" />
                                    <span class="edit-icon">✎</span>
                                </div>
                            </td>
                            <td class="text-center">2025-11-20 10:15</td>
                            <td class="text-center">김유플</td>
                            <td class="text-center"><button class="btn-ghost btn-action-icon">⋯</button></td>
                        </tr>
                    </tbody>
                </table>
                <p class="text-desc" style="margin-top: 12px;">
                    • 기능 구분별 트래픽 비율 합은 100%가 되어야 합니다. 단일 모델만 존재하는 기능의 경우 100%로 고정되며 수정할 수 없습니다.<br />
                    • 트래픽 비율 수정 후 트래픽 비율 적용 버튼을 눌러야 실제로 저장됩니다.
                </p>
            </div>



            <!-- SECTION 5: Deployment History -->
            <div class="card">
                <div class="card-header">
                    <div>
                        <h3 class="card-title">AI 모델 배포 이력</h3>
                        <p class="card-desc">해당 기업의 기능별 모델 배포, 수정, 트래픽 변경 이력을 조회합니다.</p>
                    </div>
                </div>
                <div style="display: flex; gap: 12px; margin-bottom: 16px; align-items: center;">
                    <input type="date" class="text-input" value="2025-11-01" />
                    <span>~</span>
                    <input type="date" class="text-input" value="2025-11-30" />
                    <select class="select-input">
                        <option>전체 작업 유형</option>
                        <option>생성</option>
                        <option>수정</option>
                        <option>트래픽 변경</option>
                        <option>삭제</option>
                    </select>
                    <button class="btn btn-secondary">조회</button>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>일시</th>
                            <th>기업</th>
                            <th>기능 구분</th>
                            <th>작업 유형</th>
                            <th>작업 내용</th>
                            <th>작업자</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>2025-11-20 10:15:22</td>
                            <td>Maxis</td>
                            <td>요약</td>
                            <td><span class="badge badge-blue">트래픽 변경</span></td>
                            <td>Gemini 80%, GPT 20% 적용</td>
                            <td>김유플 (uplus@lg.com)</td>
                        </tr>
                        <tr>
                            <td>2025-11-20 09:00:11</td>
                            <td>Maxis</td>
                            <td>요약</td>
                            <td><span class="badge badge-green">수정</span></td>
                            <td>GPT 5.1 모델 미수집 설정 변경</td>
                            <td>김유플 (uplus@lg.com)</td>
                        </tr>
                    </tbody>
                </table>
            </div>



            <!-- SECTION: Data Collection Status -->
            <div class="card">
                <div class="card-header">
                    <div>
                        <h3 class="card-title">데이터 수집 현황</h3>
                        <p class="card-desc">선택한 기간 동안 소속 고객사의 통화 데이터 수집 여부, 유형별 수집량 및 학습에 활용된 데이터량을 조회합니다.</p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-secondary btn-ghost"
                            style="color: var(--brand-main); background: var(--accent-chip-bg);">데이터 수집</button>
                        <button class="btn btn-primary" onclick="searchCollectionStatus()">수집 현황 조회</button>
                    </div>
                </div>

                <!-- Filter -->
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                    <span class="form-label" style="margin-right: 8px;">조회기간 설정</span>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 13px; color: var(--text-muted);">시작월</span>
                        <input type="month" class="text-input" id="coll-start-month" value="2025-09" />
                    </div>
                    <span>~</span>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 13px; color: var(--text-muted);">종료월</span>
                        <input type="month" class="text-input" id="coll-end-month" value="2025-11" />
                    </div>
                </div>

                <!-- Info Box -->
                <div
                    style="background: var(--surface-soft); padding: 12px 16px; border-radius: 8px; margin-bottom: 20px; font-size: 13px; color: var(--text-sub); display: flex; align-items: center; gap: 20px;">
                    <span id="coll-period-info" style="font-weight: 600; color: var(--brand-main-dark);">조회 기간: 2025-09
                        ~ 2025-11 (최근 수집 완료일 기준 2025-11-27)</span>
                    <span style="color: var(--text-muted); font-size: 12px;">• 종료월이 당월인 경우, 실제 데이터 수집이 완료된 날짜까지를 기준으로
                        마지막 일자를 표시합니다.</span>
                </div>

                <!-- Table -->
                <table class="data-table">
                    <colgroup>
                        <col style="width: 15%" />
                        <col style="width: 15%" />
                        <col style="width: 20%" />
                        <col style="width: 25%" />
                        <col style="width: 25%" />
                    </colgroup>
                    <thead>
                        <tr>
                            <th>고객사명</th>
                            <th class="text-center">조회기간 중 수집 여부</th>
                            <th>수집 데이터 유형</th>
                            <th>수집된 데이터량 (총 건수)</th>
                            <th>학습에 활용된 데이터량</th>
                        </tr>
                    </thead>
                    <tbody id="collection-list-body">
                        <tr>
                            <td>Maxis</td>
                            <td class="text-center"><span class="badge badge-green">ON</span></td>
                            <td>통화 전사문</td>
                            <td>1,820건</td>
                            <td>1,280건</td>
                        </tr>
                        <tr>
                            <td>Maxis</td>
                            <td class="text-center"><span class="badge badge-green">ON</span></td>
                            <td>통화 요약문</td>
                            <td>1,520건</td>
                            <td>1,240건</td>
                        </tr>
                        <tr>
                            <td>Maxis</td>
                            <td class="text-center"><span class="badge badge-red">OFF</span></td>
                            <td>기타 메타데이터</td>
                            <td>0건</td>
                            <td>0건</td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </main>
    </div>

    <!-- MODAL (Section 2): Register/Edit Model -->
    <div class="modal-backdrop" id="modal-register">
        <div class="modal-panel">
            <div class="modal-header">
                <h3 class="modal-title">AI 모델 등록</h3>
                <button class="btn-close" onclick="closeModal('modal-register')">×</button>
            </div>
            <div class="modal-body">
                <!-- Group 1: Basic Info -->
                <div class="form-group">
                    <h4 class="form-label" style="font-size: 15px; margin-bottom: 12px;">기본 정보</h4>
                    <p class="text-desc" style="margin-bottom: 16px;">타겟 기업과 서비스 기능 구분, 사용할 모델을 지정합니다.</p>

                    <div
                        style="display: grid; grid-template-columns: 140px 1fr; gap: 16px; align-items: center; margin-bottom: 12px;">
                        <span class="form-label">타겟 기업</span>
                        <input type="text" class="text-input w-full" value="Maxis" readonly
                            style="background: #f1f5f9;" />
                    </div>
                    <div
                        style="display: grid; grid-template-columns: 140px 1fr; gap: 16px; align-items: center; margin-bottom: 12px;">
                        <span class="form-label">서비스 구분</span>
                        <input type="text" class="text-input w-full" value="요약" readonly style="background: #f1f5f9;" />
                    </div>
                    <div style="display: grid; grid-template-columns: 140px 1fr; gap: 16px; align-items: center;">
                        <span class="form-label">모델</span>
                        <div style="display: flex; gap: 8px;">
                            <select class="select-input w-full">
                                <option>Gemini 2.5 Flash</option>
                                <option>GPT 5.1</option>
                            </select>
                            <div style="display: flex; gap: 8px;">
                                <select class="select-input w-full">
                                    <option>Gemini 2.5 Flash</option>
                                    <option>GPT 5.1</option>
                                </select>
                                <button class="btn btn-secondary" onclick="openModal('modal-model-mgmt')"
                                    style="white-space: nowrap; flex-shrink: 0;">모델 관리</button>
                            </div>
                        </div>
                    </div>
                    <p class="text-desc" style="margin-left: 156px; margin-top: 4px;">On-device AI-APIM에서 지원하는 Feature
                        기반 모델만 선택 가능합니다.</p>
                </div>

                <hr style="border: 0; border-top: 1px solid var(--border-soft); margin: 24px 0;" />

                <!-- Group 2: Data Collection & Security -->
                <div class="form-group">
                    <h4 class="form-label" style="font-size: 15px; margin-bottom: 12px;">데이터 수집 및 보안</h4>
                    <p class="text-desc" style="margin-bottom: 16px;">통화/이용 데이터를 학습용으로 수집할지 여부와 비식별화 수준을 설정합니다.</p>

                    <div style="display: grid; grid-template-columns: 140px 1fr; gap: 16px; margin-bottom: 16px;">
                        <span class="form-label" style="padding-top: 4px;">학습 데이터 수집</span>
                        <div>
                            <div class="toggle-row">
                                <div class="toggle-switch on"
                                    onclick="this.classList.toggle('on'); toggleCollection(this)"></div>
                                <span style="font-size: 13px; font-weight: 600;">On 선택(Off)</span>
                            </div>
                            <p class="text-desc">On: 비식별화 처리 후 AI Data Hub로 연동됩니다.</p>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 140px 1fr; gap: 16px; align-items: center;"
                        id="deid-row">
                        <span class="form-label">비식별화 레벨</span>
                        <div>
                            <select class="select-input w-full">
                                <option>레벨을 선택하세요</option>
                                <option selected>Lv 2. 마스킹 처리</option>
                                <option>Lv 3. 가명 처리</option>
                            </select>
                            <p class="text-desc" style="margin-top: 4px;">On 선택 시, 비식별화 처리 후 AI Data Hub로 연동됩니다.</p>
                        </div>
                    </div>
                </div>

                <hr style="border: 0; border-top: 1px solid var(--border-soft); margin: 24px 0;" />

                <!-- Group 3: Detail Settings -->
                <div class="form-group">
                    <h4 class="form-label" style="font-size: 15px; margin-bottom: 12px;">모델 상세 설정</h4>
                    <p class="text-desc" style="margin-bottom: 16px;">금칙어 정책과 적용 여부를 설정하여 안전한 응답을 보장합니다.</p>

                    <div
                        style="display: grid; grid-template-columns: 140px 1fr; gap: 16px; align-items: center; margin-bottom: 12px;">
                        <span class="form-label">금칙어 정책</span>
                        <div style="display: flex; gap: 8px;">
                            <select class="select-input w-full">
                                <option>정책을 선택하세요</option>
                                <option>공통 욕설 필터</option>
                            </select>
                            <div style="display: flex; gap: 8px;">
                                <select class="select-input w-full">
                                    <option>정책을 선택하세요</option>
                                    <option>공통 욕설 필터</option>
                                </select>
                                <button class="btn btn-secondary" onclick="openModal('modal-policy-mgmt')"
                                    style="white-space: nowrap; flex-shrink: 0;">금칙어 정책
                                    관리</button>
                            </div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 140px 1fr; gap: 16px; align-items: center;">
                        <span class="form-label">금칙어 적용 여부</span>
                        <div>
                            <label
                                style="display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 600; color: var(--brand-main);">
                                <input type="checkbox" checked accent-color="var(--brand-main)" />
                                적용 / 미적용
                            </label>
                            <p class="text-desc" style="margin-top: 4px;">금칙어 정책이 적용된 상태입니다. 트래픽 비율 설정이 가능하며 필터가 응답에
                                반영됩니다.</p>
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-register')">취소</button>
                <button class="btn btn-primary">저장</button>
            </div>
        </div>
    </div>

    <!-- MODAL (Section 3): Model Mgmt -->
    <div class="modal-backdrop" id="modal-model-mgmt">
        <div class="modal-panel modal-lg">
            <div class="modal-header">
                <h3 class="modal-title">모델 관리</h3>
                <button class="btn-close" onclick="closeModal('modal-model-mgmt')">×</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; gap: 24px; height: 500px;">
                    <!-- LEFT: Model List -->
                    <div
                        style="flex: 1; display: flex; flex-direction: column; border-right: 1px solid var(--border-soft); padding-right: 24px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <span class="form-label">등록된 모델</span>
                            <button class="btn btn-secondary btn-ghost" style="font-size: 11px;"
                                onclick="resetModelForm()">+ 신규</button>
                        </div>
                        <ul class="menu-list" style="overflow-y: auto; flex: 1;" id="model-mgmt-list">
                            <!-- Items will be injected -->
                            <li class="list-item active">
                                <span style="font-size: 13px;">Gemini 2.5 Flash</span>
                                <button class="btn-ghost btn-action-icon text-red" style="padding: 4px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path
                                            d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                        </path>
                                    </svg>
                                </button>
                            </li>
                            <li class="list-item">
                                <span style="font-size: 13px;">GPT 5.1</span>
                                <button class="btn-ghost btn-action-icon text-red" style="padding: 4px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path
                                            d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                        </path>
                                    </svg>
                                </button>
                            </li>
                        </ul>
                    </div>

                    <!-- RIGHT: Model Detail -->
                    <div style="flex: 1.5; padding-left: 8px;">
                        <h4 class="form-label" style="margin-bottom: 16px;">모델 상세 정보</h4>

                        <div class="form-group">
                            <label class="form-label" style="display: block; margin-bottom: 8px;">공급사 (Provider)</label>
                            <select class="select-input w-full" id="model-form-provider">
                                <option value="Google">Google</option>
                                <option value="OpenAI">OpenAI</option>
                                <option value="Anthropic">Anthropic</option>
                                <option value="HyperCLOVA X">HyperCLOVA X</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" style="display: block; margin-bottom: 8px;">모델명</label>
                            <input type="text" class="text-input w-full" id="model-form-name"
                                placeholder="모델명을 입력하세요" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveModel()">저장</button>
            </div>
        </div>
    </div>

    <!-- MODAL (Section 4): Policy Mgmt -->
    <div class="modal-backdrop" id="modal-policy-mgmt">
        <div class="modal-panel modal-lg">
            <div class="modal-header">
                <h3 class="modal-title">금칙어 정책 관리</h3>
                <button class="btn-close" onclick="closeModal('modal-policy-mgmt')">×</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; gap: 24px; height: 500px;">
                    <!-- LEFT: Policy List -->
                    <div
                        style="flex: 1; display: flex; flex-direction: column; border-right: 1px solid var(--border-soft); padding-right: 24px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <span class="form-label">정책 목록</span>
                            <button class="btn btn-secondary btn-ghost" style="font-size: 11px;"
                                onclick="resetPolicyForm()">+ 신규</button>
                        </div>
                        <ul class="menu-list" style="overflow-y: auto; flex: 1;" id="policy-mgmt-list">
                            <!-- JS Generated -->
                        </ul>
                    </div>

                    <!-- RIGHT: Policy Detail -->
                    <div style="flex: 1.5; padding-left: 8px; display: flex; flex-direction: column;">
                        <h4 class="form-label" style="margin-bottom: 16px;">정책 상세 정보</h4>

                        <div class="form-group">
                            <label class="form-label" style="display: block; margin-bottom: 8px;">정책명</label>
                            <input type="text" class="text-input w-full" value="공통 욕설 필터" />
                        </div>

                        <div class="form-group">
                            <label class="form-label" style="display: block; margin-bottom: 8px;">설명 (Optional)</label>
                            <input type="text" class="text-input w-full" value="모든 채널에 공통 적용되는 기본 욕설 DB입니다." />
                        </div>

                        <div class="form-group" style="flex: 1; display: flex; flex-direction: column;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px;">
                                <label class="form-label">금칙어 리스트</label>
                                <div style="display: flex; gap: 4px;">
                                    <button class="btn btn-secondary btn-ghost"
                                        style="padding: 4px 8px; font-size: 11px;">📥 템플릿</button>
                                    <button class="btn btn-secondary btn-ghost"
                                        style="padding: 4px 8px; font-size: 11px;">📤 일괄등록</button>
                                </div>
                            </div>

                            <div class="form-control-box"
                                style="flex: 1; background: white; display: flex; flex-direction: column; gap: 8px;">
                                <!-- Tag Input Area -->
                                <div
                                    style="display: flex; flex-wrap: wrap; gap: 6px; align-content: flex-start; flex: 1; overflow-y: auto;">
                                    <span class="chip active" style="font-size: 12px; padding: 4px 10px;">바보 <span
                                            style="margin-left: 4px; opacity: 0.7;">×</span></span>
                                    <span class="chip active" style="font-size: 12px; padding: 4px 10px;">멍청이 <span
                                            style="margin-left: 4px; opacity: 0.7;">×</span></span>
                                    <span class="chip active" style="font-size: 12px; padding: 4px 10px;">해삼 <span
                                            style="margin-left: 4px; opacity: 0.7;">×</span></span>
                                    <span class="chip active" style="font-size: 12px; padding: 4px 10px;">말미잘 <span
                                            style="margin-left: 4px; opacity: 0.7;">×</span></span>
                                    <input type="text" placeholder="단어 입력 후 Enter"
                                        style="border: none; outline: none; font-size: 13px; min-width: 120px; padding: 4px;" />
                                </div>
                            </div>
                            <p class="text-desc" style="margin-top: 4px;">쉼표(,) 또는 Enter로 구분하여 단어를 등록하세요.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeModal('modal-policy-mgmt')">저장</button>
            </div>
        </div>
    </div>

    </div>
    </div>
    <script>
        /* =========================
           Sidebar & Init
        ========================= */
        const MENU_STRUCTURE = {
            "서비스 운영": {
                "DevOps": ["Cloud AI 기능", "AI 모델"], // Added Cloud AI
            }
        };

        function renderSidebar() {
            const sidebarMenuEl = document.getElementById("sidebar-menu");
            const l3List = MENU_STRUCTURE["서비스 운영"]["DevOps"];

            const li = document.createElement("li");
            li.className = "menu-item active open";

            li.innerHTML = `
                <div class="menu-main">
                    <div class="menu-label">
                        <span class="menu-icon">📂</span>
                        <span>DevOps</span>
                    </div>
                    <span class="menu-arrow">›</span>
                </div>
                <ul class="submenu-list">
                    ${l3List.map(item => `
                        <li class="submenu-item ${item === "Cloud AI 기능" ? "active" : ""}">
                            ${item}
                        </li>
                    `).join('')}
                </ul>
            `;
            sidebarMenuEl.appendChild(li);
        }

        /* =========================
           Traffic Ratio Logic
        ========================= */
        function enableRatioEdit(el) {
            el.classList.add("editing");
            el.value = el.value.replace("%", "");
            el.select();
        }

        function formatRatio(el) {
            el.classList.remove("editing");
            let val = parseInt(el.value);
            if (isNaN(val)) val = 0;
            if (val > 100) val = 100;
            if (val < 0) val = 0;
            el.value = val + "%";

            // Activate 'Apply' button
            const applyBtn = document.getElementById("btn-apply-ratio");
            applyBtn.classList.remove("btn-dimmed");
            applyBtn.classList.remove("btn-secondary");
            applyBtn.classList.add("btn-primary");
        }

        /* Traffic Ratio Application Logic */
        document.getElementById("btn-apply-ratio").addEventListener("click", function () {
            const inputs = document.querySelectorAll(".traffic-input");
            let sum = 0;
            inputs.forEach(input => {
                sum += parseInt(input.value.replace(/[^0-9]/g, "")) || 0;
            });

            if (sum !== 100) {
                alert(`트래픽 비율의 합은 100%여야 합니다.\n현재 합계: ${sum}%`);
                return;
            }

            alert("트래픽 비율이 정상적으로 적용되었습니다.");

            // UI Reset
            this.classList.remove("btn-primary");
            this.classList.add("btn-secondary");
            this.classList.add("btn-dimmed");
        });

        /* =========================
           Modal Logic
        ========================= */
        function openModal(id) {
            const el = document.getElementById(id);
            if (el) {
                el.classList.add("open");
                // For nested modals, if opening a new modal, you might want to adjust z-index or handle backdrop status
            }
        }

        function closeModal(id) {
            const el = document.getElementById(id);
            if (el) el.classList.remove("open");
        }

        function toggleCollection(el) {
            const isOn = el.classList.contains("on");
            const deidRow = document.getElementById("deid-row");
            const select = deidRow.querySelector("select");

            if (isOn) {
                select.disabled = false;
                deidRow.style.opacity = "1";
            } else {
                select.disabled = true;
                deidRow.style.opacity = "0.5";
            }
        }

        /* Init */
        document.addEventListener("DOMContentLoaded", () => {
            renderSidebar();
            initModelMgmt();
            initPolicyMgmt();
            initCollectionStatus();
        });

        /* =========================
           Feature: Model Management
        ========================= */
        let modelData = [
            { id: 1, name: "Gemini 2.5 Flash", provider: "Google" },
            { id: 2, name: "GPT 5.1", provider: "OpenAI" }
        ];
        let currentModelId = null;

        function initModelMgmt() {
            renderModelList();
            if (modelData.length > 0) selectModel(modelData[0].id);
        }

        function renderModelList() {
            const listEl = document.getElementById("model-mgmt-list");
            listEl.innerHTML = modelData.map(m => `
                <li class="list-item ${currentModelId === m.id ? 'active' : ''}" onclick="selectModel(${m.id})">
                    <span style="font-size: 13px;">${m.name}</span>
                    <button class="btn-ghost btn-action-icon text-red" style="padding: 4px;" onclick="deleteModel(event, ${m.id})">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                    </button>
                </li>
            `).join('');
        }

        function selectModel(id) {
            currentModelId = id;
            if (!id) return;
            const model = modelData.find(m => m.id === id);
            if (model) {
                document.getElementById("model-form-provider").value = model.provider;
                document.getElementById("model-form-name").value = model.name;
            }
            renderModelList();
        }

        function resetModelForm() {
            currentModelId = null;
            renderModelList(); // Clear Selection style
            document.getElementById("model-form-provider").value = "Google";
            document.getElementById("model-form-name").value = "";
            document.getElementById("model-form-name").focus();
        }

        function deleteModel(e, id) {
            e.stopPropagation();
            if (confirm("정말 이 모델을 삭제하시겠습니까?")) {
                modelData = modelData.filter(m => m.id !== id);
                if (currentModelId === id) resetModelForm();
                else renderModelList();
            }
        }

        function saveModel() {
            const provider = document.getElementById("model-form-provider").value;
            const name = document.getElementById("model-form-name").value;

            if (!name) return alert("모델명을 입력하세요.");

            if (currentModelId) {
                // Update
                const model = modelData.find(m => m.id === currentModelId);
                model.provider = provider;
                model.name = name;
                alert("모델 정보가 수정되었습니다.");
            } else {
                // Create
                const newId = modelData.length > 0 ? Math.max(...modelData.map(m => m.id)) + 1 : 1;
                modelData.push({ id: newId, provider: provider, name: name });
                selectModel(newId);
                alert("신규 모델이 등록되었습니다.");
            }
            renderModelList();
        }

        /* =========================
           Feature: Policy Management
        ========================= */
        let policyData = [
            { id: 1, name: "공통 욕설 필터", desc: "모든 채널에 공통 적용되는 기본 욕설 DB입니다.", tags: ["바보", "멍청이", "해삼", "말미잘"] },
            { id: 2, name: "경쟁사 필터 (A사)", desc: "A사 관련 경쟁사 키워드 필터입니다.", tags: ["A텔레콤", "A모바일"] }
        ];
        let currentPolicyId = null;
        let currentTags = [];

        function initPolicyMgmt() {
            renderPolicyList();
            if (policyData.length > 0) selectPolicy(policyData[0].id);
        }

        function renderPolicyList() {
            const listEl = document.getElementById("policy-mgmt-list");
            listEl.innerHTML = policyData.map(p => `
                <li class="list-item ${currentPolicyId === p.id ? 'active' : ''}" onclick="selectPolicy(${p.id})">
                    <span style="font-size: 13px;">${p.name}</span>
                    <button class="btn-ghost btn-action-icon text-red" style="padding: 4px;" onclick="deletePolicy(event, ${p.id})">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                    </button>
                </li>
            `).join('');
        }

        function selectPolicy(id) {
            currentPolicyId = id;
            if (!id) return;
            const policy = policyData.find(p => p.id === id);
            if (policy) {
                document.getElementById("policy-form-name").value = policy.name;
                document.getElementById("policy-form-desc").value = policy.desc;
                currentTags = [...policy.tags];
                renderTags();
            }
            renderPolicyList();
        }

        function resetPolicyForm() {
            currentPolicyId = null;
            renderPolicyList();
            document.getElementById("policy-form-name").value = "";
            document.getElementById("policy-form-desc").value = "";
            currentTags = [];
            renderTags();
            document.getElementById("policy-form-name").focus();
        }

        function deletePolicy(e, id) {
            e.stopPropagation();
            if (confirm("정말 이 정책을 삭제하시겠습니까?")) {
                policyData = policyData.filter(p => p.id !== id);
                if (currentPolicyId === id) resetPolicyForm();
                else renderPolicyList();
            }
        }

        function renderTags() {
            const container = document.getElementById("policy-tags-container");
            container.innerHTML = currentTags.map((tag, index) => `
                <span class="chip active" style="font-size: 12px; padding: 4px 10px;">
                    ${tag}
                    <span style="margin-left: 4px; opacity: 0.7; cursor: pointer;" onclick="removeTag(${index})">×</span>
                </span>
            `).join('');
        }

        function handleTagInput(e) {
            if (e.key === "Enter" || e.key === ",") {
                e.preventDefault();
                const val = e.target.value.trim().replace(/,/g, '');
                if (val && !currentTags.includes(val)) {
                    currentTags.push(val);
                    renderTags();
                    e.target.value = "";
                    // Scroll to bottom
                    setTimeout(() => {
                        const container = document.getElementById("policy-tags-container");
                        container.scrollTop = container.scrollHeight;
                    }, 0);
                }
            }
        }

        function removeTag(index) {
            currentTags.splice(index, 1);
            renderTags();
        }

        /* =========================
           Feature: Data Collection Status
        ========================= */
        function initCollectionStatus() {
            searchCollectionStatus();
        }

        function searchCollectionStatus() {
            const start = document.getElementById("coll-start-month").value;
            const end = document.getElementById("coll-end-month").value;

            // Update Info Text (Mock Logic for "Latest Date")
            const infoEl = document.getElementById("coll-period-info");
            // Simple logic: if end month is 2025-11, show 27th. Else show end of month.
            let rangeText = `조회 기간: ${start} ~ ${end}`;
            if (end === "2025-11") {
                rangeText += " (최근 수집 완료일 기준 2025-11-27)";
            } else {
                rangeText += " (최근 수집 완료일 기준 " + end + "-30)";
            }
            infoEl.textContent = rangeText;

            // Render Table
            const tbody = document.getElementById("collection-list-body");
            tbody.innerHTML = `
                <tr>
                    <td>Maxis</td>
                    <td class="text-center"><span class="badge badge-green">ON</span></td>
                    <td>통화 전사문</td>
                    <td>1,820건</td>
                    <td>1,280건</td>
                </tr>
                <tr>
                    <td>Maxis</td>
                    <td class="text-center"><span class="badge badge-green">ON</span></td>
                    <td>통화 요약문</td>
                    <td>1,520건</td>
                    <td>1,240건</td>
                </tr>
                <tr>
                    <td>Maxis</td>
                    <td class="text-center"><span class="badge badge-red">OFF</span></td>
                    <td>기타 메타데이터</td>
                    <td>0건</td>
                    <td>0건</td>
                </tr>
            `;
        }

        function savePolicy() {
            const name = document.getElementById("policy-form-name").value;
            const desc = document.getElementById("policy-form-desc").value;

            if (!name) return alert("정책명을 입력하세요.");

            if (currentPolicyId) {
                // Update
                const policy = policyData.find(p => p.id === currentPolicyId);
                policy.name = name;
                policy.desc = desc;
                policy.tags = [...currentTags];
                alert("정책이 수정되었습니다.");
            } else {
                // Create
                const newId = policyData.length > 0 ? Math.max(...policyData.map(p => p.id)) + 1 : 1;
                policyData.push({ id: newId, name: name, desc: desc, tags: [...currentTags] });
                selectPolicy(newId);
                alert("신규 정책이 등록되었습니다.");
            }
            renderPolicyList();
        }
    </script>
</body>

</html>