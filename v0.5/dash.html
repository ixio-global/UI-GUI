<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ixi-O O&M â€“ ì‚¬ì—… ì‹¤ì  ê´€ë¦¬(ì‹¤ì  ì¢…í•©)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }

    /* =========================
       Color Design Tokens
       (ixi enterprise ì‚¬ìš©ì ê´€ë¦¬ ëŠë‚Œ + ë³´ë¼ ê·¸ë¼ë°ì´ì…˜)
    ========================= */
    :root {
      /* Base */
      --bg-body: #f3f4ff;
      --text-main: #111827;
      --text-sub: #4b5563;
      --text-muted: #6b7280;
      --text-light: #9ca3af;

      /* Brand / Primary (ë³´ë¼ ê·¸ë¼ë°ì´ì…˜) */
      --brand-grad-from: #8b5cf6;
      --brand-grad-to:   #ec4899;
      --brand-main:      #7c3aed;
      --brand-main-dark: #5b21b6;
      --brand-main-deep: #4c1d95;

      /* Surface / Border */
      --surface:        #ffffff;
      --surface-soft:   #f5f3ff;
      --surface-softer: #f9fafb;
      --border-soft:    #e5e7eb;
      --border-input:   #e5e0ff;

      /* Sidebar / Menu */
      --sidebar-bg:    #f5f3ff;
      --sidebar-title: #6b7280;
      --menu-text:     #111827;
      --submenu-dot:   #d4bfff;

      /* Accents */
      --accent-chip-bg:        #f3f4ff;
      --accent-chip-bg-strong: #e5e7ff;
      --accent-chip-text:      #4b5563;
      --accent-hover:          #f3f4ff;
      --accent-row-alt:        #faf5ff;
      --accent-link:           #4c1d95;

      /* Buttons */
      --btn-primary-bg:        #7c3aed;
      --btn-primary-bg-hover:  #5b21b6;
      --btn-dark-bg:           #111827;
      --btn-dark-bg-hover:     #1f2937;
      --btn-danger-border:     #f97373;
      --btn-danger-text:       #b91c1c;
      --btn-danger-bg-hover:   #fef2f2;

      --stub-border: #e5e7eb;
      --row-selected-bg: #ede9fe;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Noto Sans KR", system-ui, sans-serif;
      background: var(--bg-body);
      color: var(--text-main);
    }

    input[type="checkbox"] {
      accent-color: var(--brand-main);
    }

    /* =========================
       í—¤ë”
    ========================= */
    .header {
      position: fixed;
      inset: 0 0 auto 0;
      height: 60px;
      padding: 0 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(90deg, var(--brand-grad-from), var(--brand-grad-to));
      color: #ffffff;
      z-index: 20;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 80px;
    }
    .logo {
      font-weight: 800;
      font-size: 20px;
      letter-spacing: 0.04em;
    }
    .top-nav {
      display: flex;
      gap: 40px;
      font-size: 15px;
    }
    .top-nav-item {
      padding: 6px 10px;
      border-radius: 999px;
      cursor: pointer;
      opacity: 0.9;
      white-space: nowrap;
    }
    .top-nav-item:hover {
      background: rgba(255, 255, 255, 0.18);
      opacity: 1;
    }
    .top-nav-item.active {
      background: #ffffff;
      color: #4c1d95;
      font-weight: 600;
      opacity: 1;
    }
    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 13px;
    }
    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.95);
      color: var(--brand-main);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
    }

    /* =========================
       ë ˆì´ì•„ì›ƒ
    ========================= */
    .layout {
      display: flex;
      margin-top: 60px;
      min-height: calc(100vh - 60px);
    }

    .sidebar {
      width: 260px;
      background: var(--sidebar-bg);
      border-right: 1px solid var(--border-soft);
      padding: 24px 16px;
    }
    .sidebar-section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--sidebar-title);
      margin-bottom: 12px;
    }
    .menu-list {
      list-style: none;
      padding: 0;
      margin: 2;
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 14px;
    }
    .menu-item {
      border-radius: 10px;
      color: var(--menu-text);
    }
    .menu-main {
      padding: 10px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      border-radius: 10px;
    }
    .menu-main:hover {
      background: #ede9fe;
    }
    .menu-item.active > .menu-main {
      background: var(--brand-main);
      color: #ffffff;
      font-weight: 600;
    }
    .menu-label {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .menu-icon {
      width: 20px;
      height: 20px;
      border-radius: 6px;
      background: #ede9fe;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: var(--brand-main);
    }
    .menu-item.active .menu-icon {
      background: rgba(255, 255, 255, 0.22);
      color: #ffffff;
    }
    .menu-arrow {
      font-size: 12px;
      transition: transform 0.15s ease-out;
    }
    .menu-item.open .menu-arrow {
      transform: rotate(90deg);
    }
    .submenu-list {
      list-style: none;
      padding: 0;
      margin: 4px 0 4px 32px;
      display: none;
    }
    .menu-item.open .submenu-list {
      display: block;
    }
    .submenu-item {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 13px;
      color: var(--text-sub);
      cursor: pointer;
      position: relative;
    }
    .submenu-item::before {
      content: "";
      position: absolute;
      left: -10px;
      top: 50%;
      transform: translateY(-50%);
      width: 3px;
      height: 3px;
      border-radius: 999px;
      background: var(--submenu-dot);
    }
    .submenu-item:hover {
      background: #f5f3ff;
    }
    .submenu-item.active {
      background: #ede9fe;
      color: var(--brand-main-dark);
      font-weight: 600;
    }
    .submenu-item.active::before {
      background: var(--brand-main);
    }

    .main {
      flex: 1;
      padding: 24px 32px 32px;
      overflow: auto;
    }
    #page-inner {
      max-width: 1360px;
      margin: 0 auto;
    }

    .breadcrumb {
      font-size: 14px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 12px;
    }
    .breadcrumb span.current {
      color: var(--text-main);
      font-weight: 600;
    }
    .page-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 16px;
      color: var(--text-main);
    }
    .page-subtitle {
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 16px;
    }

    /* =========================
       ê³µí†µ ì¹´ë“œ / ë²„íŠ¼ / í¼
    ========================= */
    .board-header-panel,
    .board-card {
      background: var(--surface);
      border-radius: 16px;
      padding: 16px 20px 18px;
      margin-bottom: 16px;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.06);
      border: 1px solid var(--border-soft);
    }

    .board-header-top {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .board-header-title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .board-header-title h2 {
      margin: 0;
      font-size: 16px;
      font-weight: 700;
    }
    .board-header-title span {
      font-size: 12px;
      color: var(--text-sub);
    }

    .filter-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px 24px;
      align-items: flex-end;
      margin-top: 12px;
    }
    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
      color: var(--text-sub);
    }
    .field label {
      font-weight: 600;
      color: var(--text-main);
    }
    .field small {
      font-size: 11px;
      color: var(--text-muted);
    }
    .field-inline {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--text-sub);
      flex-wrap: wrap;
    }

    .field input,
    .field select {
      padding: 7px 10px;
      border-radius: 10px;
      border: 1px solid var(--border-input);
      background: #fafafc;
      font-size: 13px;
      outline: none;
      color: var(--text-main);
      min-width: 150px;
    }
    .field input[type="month"] {
      min-width: 130px;
    }
    .field select:focus,
    .field input:focus {
      border-color: var(--brand-main);
      box-shadow: 0 0 0 1px rgba(124, 58, 237, 0.18);
      background: #ffffff;
    }

    .btn-primary {
      padding: 9px 18px;
      border-radius: 999px;
      border: none;
      background: var(--btn-primary-bg);
      color: #ffffff;
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 8px 18px rgba(124, 58, 237, 0.35);
      white-space: nowrap;
    }
    .btn-primary:hover {
      background: var(--btn-primary-bg-hover);
    }
    .btn-ghost {
      padding: 7px 14px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #ffffff;
      color: var(--text-sub);
      font-size: 12px;
      cursor: pointer;
      white-space: nowrap;
    }
    .btn-ghost:hover {
      background: var(--surface-soft);
    }

    .chip-toggle {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #ffffff;
      font-size: 12px;
      cursor: pointer;
      color: var(--text-sub);
    }
    .chip-toggle.active {
      background: var(--brand-main);
      color: #ffffff;
      border-color: var(--brand-main);
      font-weight: 500;
    }

    .pill-inline {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--accent-chip-bg);
      font-size: 11px;
      color: var(--text-sub);
    }
    .pill-inline strong {
      color: var(--text-main);
    }

    /* =========================
       ê·¸ë˜í”„ ì¹´ë“œ / ìš”ì•½
    ========================= */
    .card-header-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 12px;
    }
    .card-title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .card-title {
      font-size: 15px;
      font-weight: 600;
    }
    .card-subtitle {
      font-size: 12px;
      color: var(--text-sub);
    }

    .card-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 11px;
      color: var(--text-sub);
    }
    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      background: var(--surface-soft);
    }
    .legend-color-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #c4b5fd;
    }
    .legend-color-dot.alt1 { background: #f97373; }
    .legend-color-dot.alt2 { background: #4ade80; }
    .legend-color-dot.alt3 { background: #38bdf8; }

    .chart-wrapper {
      position: relative;
      width: 100%;
      height: 260px;
      margin-top: 4px;
    }

    .kpi-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 14px;
      font-size: 12px;
    }
    .kpi-pill {
      flex: 1 1 140px;
      min-width: 0;
      padding: 8px 10px;
      border-radius: 10px;
      background: var(--surface-soft);
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .kpi-label {
      color: var(--text-muted);
      font-size: 11px;
    }
    .kpi-value {
      font-weight: 600;
      font-size: 13px;
    }

    /* Detail ëª¨ë“œ ì „ìš© ë ˆì´ì•„ì›ƒ */
    .detail-layout {
      display: grid;
      grid-template-columns: minmax(0, 2.3fr) minmax(260px, 1fr);
      gap: 16px;
      align-items: flex-start;
    }
    .detail-panel {
      border-radius: 14px;
      border: 1px dashed var(--border-soft);
      background: var(--surface-softer);
      padding: 12px 14px;
      font-size: 12px;
      color: var(--text-sub);
    }
    .detail-panel-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text-main);
    }
    .detail-panel dl {
      margin: 0;
    }
    .detail-panel dt {
      font-weight: 600;
      margin-top: 6px;
    }
    .detail-panel dd {
      margin: 0;
      margin-top: 2px;
    }

    .section-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .footnote {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 8px;
      line-height: 1.6;
    }

    /* Stub ì¹´ë“œ */
    .stub-card {
      background: var(--surface);
      border-radius: 12px;
      border: 1px dashed var(--stub-border);
      padding: 32px 24px;
      text-align: center;
      color: var(--text-muted);
      font-size: 14px;
      margin-top: 8px;
    }
    .stub-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 8px;
    }
    .stub-desc {
      margin: 0;
      line-height: 1.6;
    }

    @media (max-width: 960px) {
      .layout {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid var(--border-soft);
      }
      .main {
        padding: 18px 14px 24px;
      }
      #page-inner {
        max-width: 100%;
      }
      .detail-layout {
        grid-template-columns: minmax(0, 1fr);
      }
      .board-header-panel,
      .board-card {
        padding: 14px 14px 16px;
      }
    }

    /* ìƒë‹¨ í—¤ë”/ì‚¬ì´ë“œë°” í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
    .top-nav-item,
    .top-nav-item *,
    .menu-item,
    .menu-main,
    .menu-label,
    .submenu-item,
    .submenu-item::before,
    .menu-icon {
      cursor: pointer !important;
      user-select: none;
    }
  </style>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <!-- í—¤ë” -->
  <header class="header">
    <div class="header-left">
      <div class="logo">ixi-O O&M</div>
      <nav class="top-nav">
        <div class="top-nav-item active" data-top-label="ìƒí’ˆ ìš´ì˜">ìƒí’ˆ ìš´ì˜</div>
        <div class="top-nav-item" data-top-label="ì„œë¹„ìŠ¤ ìš´ì˜">ì„œë¹„ìŠ¤ ìš´ì˜</div>
        <div class="top-nav-item" data-top-label="ì„œë¹„ìŠ¤ ì •ì‚°">ì„œë¹„ìŠ¤ ì •ì‚°</div>
        <div class="top-nav-item" data-top-label="ì¼ë°˜">ì¼ë°˜</div>
      </nav>
    </div>
    <div class="header-right">
      <div class="avatar">A</div>
      <span>ê´€ë¦¬ì</span>
    </div>
  </header>

  <div class="layout">
    <!-- ì‚¬ì´ë“œë°” -->
    <aside class="sidebar">
      <div class="sidebar-section-title">ìƒí’ˆ ìš´ì˜</div>
      <ul class="menu-list" id="sidebar-menu"></ul>
    </aside>

    <!-- ë©”ì¸ -->
    <main class="main">
      <div id="page-inner">
        <div class="breadcrumb" id="breadcrumb">
          <span>ìƒí’ˆ ìš´ì˜</span>
          <span>â€º</span>
          <span>ëŒ€ì‹œë³´ë“œ</span>
          <span>â€º</span>
          <span class="current">ì‚¬ì—… ì‹¤ì  ê´€ë¦¬</span>
        </div>

        <div class="page-title" id="page-title">ì‚¬ì—… ì‹¤ì  ê´€ë¦¬ (ì‹¤ì  ì¢…í•©)</div>
        <div class="page-subtitle">
          ê³ ê°ì‚¬ë³„ ê°€ì…ìÂ·ì²­êµ¬Â·ìˆ˜ë‚© ì§€í‘œë¥¼ í•œ í™”ë©´ì—ì„œ ë¹„êµí•˜ê³ , ë‹¨ì¼ ê³ ê°ì‚¬ ìƒì„¸ê¹Œì§€ ë“œë¦´ë‹¤ìš´í•˜ëŠ” í™”ë©´ì…ë‹ˆë‹¤.
        </div>

        <div id="page-content">
          <!-- ===========================
               ì‚¬ì—… ì‹¤ì  ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ
          ============================ -->
          <section id="performance-dashboard">
            <!-- Section 1. ì¡°íšŒ ì¡°ê±´ ì„¤ì • -->
            <section class="board-header-panel" id="filter-section">
              <div class="board-header-top">
                <div class="board-header-title">
                  <h2>ì¡°íšŒ ì¡°ê±´ ì„¤ì •</h2>
                  <span>ì¡°íšŒê¸°ê°„(ìµœëŒ€ 3ë…„)Â·ê³ ê°ì‚¬Â·ì²­êµ¬ê¸ˆì•¡ ìœ í˜•ì„ ì„ íƒí•œ í›„ â€˜ì¡°íšŒâ€™ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹¤ì ì„ í™•ì¸í•©ë‹ˆë‹¤.</span>
                  <span style="font-size:11px;color:var(--text-muted);">
                    â€» Phase 1ì—ì„œëŠ” ë‹¨ì¼ ê³ ê°ì‚¬(Maxis) ê¸°ì¤€ìœ¼ë¡œë§Œ ì¡°íšŒë©ë‹ˆë‹¤.
                  </span>
                </div>
                <div>
                  <div class="pill-inline">
                    <span>ë³¸ í˜ì´ì§€ ìš©ë„:</span>
                    <strong>ê³ ê°ì‚¬ë³„ ì‚¬ì—…ì§€í‘œ ì¶”ì´ ì§ê´€ì  ê´€ì°° ë° ë¹„êµ</strong>
                  </div>
                </div>
              </div>

              <div class="filter-row">
                <div class="field">
                  <label>ì¡°íšŒê¸°ê°„</label>
                  <div class="field-inline">
                    <input type="month" id="start-month" value="2025-01" />
                    <span style="font-size:11px;color:var(--text-muted);">~</span>
                    <input type="month" id="end-month" value="2025-12" />
                  </div>
                  <small>ìµœëŒ€ 36ê°œì›”(3ë…„) ì´ë‚´ ë²”ìœ„ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.</small>
                </div>

                <div class="field">
                  <label>ì¡°íšŒí•  ê³ ê°ì‚¬</label>
                  <select id="customer-select" disabled>
                    <option value="maxis">Maxis (Mì‚¬)</option>
                  </select>
                  <small>Phase 1: Maxis 1ê°œë§Œ ë…¸ì¶œ Â· ì¶”í›„ ë‹¤ìˆ˜ ê³ ê°ì‚¬ ëª©ë¡ ë° ê²€ìƒ‰ ì œê³µ ì˜ˆì •</small>
                </div>

                <div class="field">
                  <label>ì²­êµ¬ê¸ˆì•¡ ìœ í˜•</label>
                  <div class="field-inline">
                    <label><input type="checkbox" id="bill-type-recurring" checked /> ë°˜ë³µì„±</label>
                    <label><input type="checkbox" id="bill-type-onetime" checked /> ì¼íšŒì„±</label>
                  </div>
                  <small>ë””í´íŠ¸: ë°˜ë³µì„±Â·ì¼íšŒì„± ëª¨ë‘ ì„ íƒëœ ìƒíƒœ</small>
                </div>

                <div class="field">
                  <label style="visibility:hidden;">ì¡°íšŒ ë²„íŠ¼</label>
                  <button class="btn-primary" id="btn-run-query">ì¡°íšŒ</button>
                </div>
              </div>

              <div class="footnote">
                - ì§€í‘œ ë³´ê´€ ê¸°ê°„ì€ ì‚¬ì—…ì§€í‘œ ê¸°ì¤€ ì˜êµ¬ì´ë©°, ì§€í‘œ ì‚°ì¶œì— ì‚¬ìš©ëœ ì›ì²œ ë°ì´í„°(ê°€ì…ì¼Â·ê¸°ëŠ¥ë³„ ì‚¬ìš©ëŸ‰ ë“±)ëŠ” ì •ì‚° ì´ì˜ ì œê¸° ê¸°ê°„ì„ ê³ ë ¤í•´ Nê°œì›” í›„ íŒŒê¸°í•©ë‹ˆë‹¤.<br/>
                - (AI APIM ê¸°ì¤€) ê¸°ëŠ¥ í˜¸ì¶œ ìˆ˜Â·í† í° ìˆ˜ ë“±ì€ ë‚´ë¶€ ì›ê°€ ê´€ë¦¬ìš© ë³„ë„ ë¦¬í¬íŠ¸ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.
              </div>
            </section>

            <!-- Section 2. ê°€ì…ì ì¶”ì´ ê·¸ë˜í”„ -->
            <section class="board-card" id="subscribers-section">
              <div class="section-label">Section 2 Â· Subscribers</div>
              <div class="card-header-row">
                <div class="card-title-block">
                  <div class="card-title">ê°€ì…ì ì¶”ì´ ê·¸ë˜í”„</div>
                  <div class="card-subtitle">
                    ì„ íƒí•œ ê¸°ê°„ ë™ì•ˆ ê³ ê°ì‚¬ë³„ ì›” í‰ê·  ê°€ì…ì ì¶”ì´ë¥¼ ëˆ„ì  ì˜ì—­ ê·¸ë˜í”„ë¡œ ì œê³µí•©ë‹ˆë‹¤.
                  </div>
                </div>
                <div class="card-legend">
                  <div class="legend-item">
                    <span class="legend-color-dot"></span>
                    <span>ì›” í‰ê·  ê°€ì…ììˆ˜ (Maxis)</span>
                  </div>
                  <div class="legend-item">
                    <span>ì¡°íšŒê¸°ê°„:</span>
                    <strong id="legend-period-sub">2025.01 ~ 2025.12</strong>
                  </div>
                  <div class="legend-item">
                    <span>í•„í„°:</span>
                    <strong>Maxis 1ê°œì‚¬</strong>
                  </div>
                </div>
              </div>

              <div class="chart-wrapper">
                <canvas id="subscribersChart"></canvas>
              </div>

              <div class="kpi-row" id="sub-kpi-row">
                <div class="kpi-pill">
                  <div class="kpi-label">ê¸°ê°„ í‰ê·  ê°€ì…ììˆ˜</div>
                  <div class="kpi-value" id="kpi-sub-avg">12,450 ëª…</div>
                </div>
                <div class="kpi-pill">
                  <div class="kpi-label">ìµœëŒ€ ê°€ì…ììˆ˜(ì›”)</div>
                  <div class="kpi-value" id="kpi-sub-max">13,200 ëª…</div>
                </div>
                <div class="kpi-pill">
                  <div class="kpi-label">ìµœì†Œ ê°€ì…ììˆ˜(ì›”)</div>
                  <div class="kpi-value" id="kpi-sub-min">11,800 ëª…</div>
                </div>
              </div>
            </section>

            <!-- Section 3. ì²­êµ¬ê¸ˆì•¡ ì¶”ì´ ê·¸ë˜í”„ (ë³µìˆ˜ ê³ ê°ì‚¬ Overview) -->
            <section class="board-card" id="billing-multi-section">
              <div class="section-label">Section 3 Â· Billing â€“ Overview</div>
              <div class="card-header-row">
                <div class="card-title-block">
                  <div class="card-title">ì²­êµ¬ê¸ˆì•¡ ì¶”ì´ ê·¸ë˜í”„ (ë³µìˆ˜ ê³ ê°ì‚¬ ê´€ì )</div>
                  <div class="card-subtitle">
                    ê° ê³ ê°ì‚¬ë³„ ì´ ì²­êµ¬ê¸ˆì•¡(ë°˜ë³µì„± + ì¼íšŒì„±)ì„ ëˆ„ì  ì˜ì—­ ê·¸ë˜í”„ë¡œ í‘œí˜„í•©ë‹ˆë‹¤.
                  </div>
                </div>
                <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end;">
                  <div class="card-legend">
                    <div class="legend-item">
                      <span class="legend-color-dot"></span>
                      <span>ì´ ì²­êµ¬ê¸ˆì•¡ (Maxis)</span>
                    </div>
                    <div class="legend-item">
                      <span>ì¡°íšŒê¸°ê°„:</span>
                      <strong id="legend-period-bill">2025.01 ~ 2025.12</strong>
                    </div>
                    <div class="legend-item">
                      <span>ì²­êµ¬ ìœ í˜•:</span>
                      <strong id="legend-bill-type">ë°˜ë³µì„± + ì¼íšŒì„±</strong>
                    </div>
                  </div>
                  <div class="field-inline" style="justify-content:flex-end;">
                    <button class="btn-ghost" id="btn-detail-mode">ë‹¨ì¼ ê³ ê°ì‚¬ ìƒì„¸ ë³´ê¸°</button>
                  </div>
                </div>
              </div>

              <div class="chart-wrapper">
                <canvas id="billingMultiChart"></canvas>
              </div>

              <div class="kpi-row" id="bill-multi-kpi-row">
                <div class="kpi-pill">
                  <div class="kpi-label">ì¡°íšŒê¸°ê°„ ì´ ì²­êµ¬ê¸ˆì•¡ ëˆ„ê³„</div>
                  <div class="kpi-value" id="kpi-bill-total">85.3 ì–µì›</div>
                </div>
                <div class="kpi-pill">
                  <div class="kpi-label">ë°˜ë³µì„± ì²­êµ¬ê¸ˆì•¡ ëˆ„ê³„</div>
                  <div class="kpi-value" id="kpi-bill-rec">74.1 ì–µì›</div>
                </div>
                <div class="kpi-pill">
                  <div class="kpi-label">ì¼íšŒì„± ì²­êµ¬ê¸ˆì•¡ ëˆ„ê³„</div>
                  <div class="kpi-value" id="kpi-bill-one">11.2 ì–µì›</div>
                </div>
                <div class="kpi-pill">
                  <div class="kpi-label">ì´ ìˆ˜ë‚©ê¸ˆì•¡ ëˆ„ê³„ / ìˆ˜ë‚©ìœ¨</div>
                  <div class="kpi-value" id="kpi-bill-collect">82.7 ì–µì› (97.0%)</div>
                </div>
              </div>

              <div class="footnote">
                - ê·¸ë˜í”„ ì˜ì—­ì—ì„œ ê³ ê°ì‚¬ ì˜ì—­ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ ê³ ê°ì‚¬ë§Œ í•„í„°ëœ ë‹¨ì¼ ê³ ê°ì‚¬ ìƒì„¸ ëª¨ë“œ(Section 4)ë¡œ ì „í™˜í•˜ëŠ” ê²ƒì„ ê¸°ë³¸ í”Œë¡œìš°ë¡œ ê°€ì •í•©ë‹ˆë‹¤.<br/>
                - Phase 1 ê¸°ì¤€ìœ¼ë¡œëŠ” Maxis 1ê°œì‚¬ë§Œ ì¡´ì¬í•˜ë¯€ë¡œ, ì¶”ê°€ ê³ ê°ì‚¬ê°€ ë¶™ì„ ê²½ìš°ë¥¼ ê³ ë ¤í•œ UX ìŠ¤ì¼ˆë ˆí†¤ì…ë‹ˆë‹¤.
              </div>
            </section>

            <!-- Section 4. ì²­êµ¬ê¸ˆì•¡ ì¶”ì´ ê·¸ë˜í”„ (ë‹¨ì¼ ê³ ê°ì‚¬ Detail) -->
            <section class="board-card" id="billing-detail-section" style="display:none;">
              <div class="section-label">Section 4 Â· Billing â€“ Detail (Single Customer)</div>
              <div class="card-header-row">
                <div class="card-title-block">
                  <div class="card-title">ì²­êµ¬ê¸ˆì•¡ ì¶”ì´ ê·¸ë˜í”„ â€“ ë‹¨ì¼ ê³ ê°ì‚¬ (Maxis)</div>
                  <div class="card-subtitle">
                    ì²­êµ¬ê¸ˆì•¡ ìœ í˜•(ì¼íšŒì„± / ë°˜ë³µì„± / ì „ì²´)ì— ë”°ë¼ ê·¸ë˜í”„ êµ¬ì„±ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.
                  </div>
                </div>
                <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end;">
                  <div class="field-inline">
                    <span style="font-size:11px;color:var(--text-muted);">ì²­êµ¬ê¸ˆì•¡ ìœ í˜• ë³´ê¸°</span>
                    <button class="chip-toggle active" data-detail-mode="both">ì „ì²´(ì¼+ë°˜ë³µ)</button>
                    <button class="chip-toggle" data-detail-mode="recurring">ë°˜ë³µì„±</button>
                    <button class="chip-toggle" data-detail-mode="onetime">ì¼íšŒì„±</button>
                  </div>
                  <div class="field-inline">
                    <button class="btn-ghost" id="btn-back-overview">Overviewë¡œ ëŒì•„ê°€ê¸°</button>
                  </div>
                </div>
              </div>

              <div class="detail-layout">
                <div>
                  <div class="chart-wrapper">
                    <canvas id="billingDetailChart"></canvas>
                  </div>
                  <div class="footnote">
                    - ë§‰ëŒ€ë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ ì›”ì˜ ì²­êµ¬ ìƒì„¸(ì¼íšŒì„± ë‚´ì—­ / í• ì¸Â·ê³¼ê¸ˆ ìš”ì†Œ)ë¥¼ ìš°ì¸¡ íŒ¨ë„ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
                    - â€˜ì¼íšŒì„±â€™ ëª¨ë“œ: ì¼íšŒì„± ì²­êµ¬ê¸ˆì•¡Â·í¬ë ˆë”§ ì”ì•¡ì„ xì¶• ê¸°ì¤€ ìœ„/ì•„ë˜ë¡œ í‘œí˜„í•˜ëŠ” ëˆ„ì  ë§‰ëŒ€ ê·¸ë˜í”„<br/>
                    - â€˜ë°˜ë³µì„±â€™ ëª¨ë“œ: ë°˜ë³µì„± ì²­êµ¬ê¸ˆì•¡Â·ì´ í• ì¸ê¸ˆì•¡Â·ì´ ê³¼ê¸ˆê¸ˆì•¡(í• ì¸ ì „)ì„ ëˆ„ì  ë§‰ëŒ€ + ë°˜ë³µì„± ì²­êµ¬ê¸ˆì•¡ êº¾ì€ì„ ìœ¼ë¡œ ë™ì‹œ í‘œí˜„<br/>
                    - â€˜ì „ì²´(ì¼+ë°˜ë³µ)â€™ ëª¨ë“œ: ì´ ì²­êµ¬Â·ë°˜ë³µì„±Â·ì¼íšŒì„±Â·ì´ ìˆ˜ë‚©ê¸ˆì•¡/ìˆ˜ë‚©ìœ¨ì„ ê·¸ë£¨í•‘ëœ ëˆ„ì  ë§‰ëŒ€ ê·¸ë˜í”„ë¡œ í‘œí˜„
                  </div>
                  <div style="margin-top:8px;">
                    <button class="btn-ghost" id="btn-export-csv">í˜„ì¬ ê·¸ë˜í”„ ì§€í‘œ CSV ë‹¤ìš´ë¡œë“œ</button>
                    <span style="font-size:11px;color:var(--text-muted);margin-left:6px;">
                      (í˜„ì¬ í‘œì‹œëœ ê·¸ë˜í”„ì˜ ì†ì„±ë“¤ì„ CSV í¬ë§·ìœ¼ë¡œ ë‚´ë³´ë‚´ëŠ” ê¸°ëŠ¥)
                    </span>
                  </div>
                </div>

                <aside class="detail-panel">
                  <div class="detail-panel-title">ì²­êµ¬ë‚´ì—­ ìƒì„¸ (ì˜ˆì‹œ Â· 2025-08 Â· Maxis)</div>
                  <dl>
                    <dt>ì¼íšŒì„± ì²­êµ¬ ë‚´ì—­</dt>
                    <dd>- êµ¬ì¶• ê³ ë„í™” 2ë‹¨ê³„ ì”ê¸ˆ ì²­êµ¬: 3.2ì–µ<br/>- ì›ì²œ ë°ì´í„° ëˆ„ë½ì— ë”°ë¥¸ ë³´ì • ì²­êµ¬: 0.4ì–µ</dd>

                    <dt>í¬ë ˆë”§ ì°¨ê° ë° ì”ì•¡</dt>
                    <dd>- ë‹¹ì›” í¬ë ˆë”§ ì°¨ê°ì•¡: 0.6ì–µ<br/>- ì¡°íšŒê¸°ê°„ ë§ ê¸°ì¤€ í¬ë ˆë”§ ì”ì•¡: 1.8ì–µ</dd>

                    <dt>ë°˜ë³µì„± ì²­êµ¬ êµ¬ì„±(ì›”)</dt>
                    <dd>- ê¸°ë³¸ êµ¬ë… ê³¼ê¸ˆê¸ˆì•¡(í• ì¸ ì „): 7.5ì–µ<br/>
                        - ì´ í• ì¸ê¸ˆì•¡(ê³¼ê¸ˆí• ì¸+ì²­êµ¬í• ì¸): 0.9ì–µ<br/>
                        - ë°˜ë³µì„± ì²­êµ¬ê¸ˆì•¡(í• ì¸ í›„): 6.6ì–µ</dd>

                    <dt>ìˆ˜ë‚© í˜„í™©</dt>
                    <dd>- ë‹¹ì›” ìˆ˜ë‚©ê¸ˆì•¡: 9.7ì–µ<br/>
                        - ìˆ˜ë‚©ìœ¨(ì›” ê¸°ì¤€): 98.1%<br/>
                        - ì¡°íšŒê¸°ê°„ ìˆ˜ë‚©ìœ¨(ê¸°ê°„ ê¸°ì¤€): 97.0%</dd>
                  </dl>
                </aside>
              </div>

              <div class="kpi-row" id="bill-detail-kpi-row" style="margin-top:14px;">
                <div class="kpi-pill">
                  <div class="kpi-label">ì¡°íšŒê¸°ê°„ ì´ ì²­êµ¬ê¸ˆì•¡ ëˆ„ê³„</div>
                  <div class="kpi-value" id="kpi-detail-total">85.3 ì–µì›</div>
                </div>
                <div class="kpi-pill">
                  <div class="kpi-label">ë°˜ë³µì„± ì²­êµ¬ê¸ˆì•¡ ëˆ„ê³„</div>
                  <div class="kpi-value" id="kpi-detail-rec">74.1 ì–µì›</div>
                </div>
                <div class="kpi-pill">
                  <div class="kpi-label">ì¼íšŒì„± ì²­êµ¬ê¸ˆì•¡ ëˆ„ê³„</div>
                  <div class="kpi-value" id="kpi-detail-one">11.2 ì–µì›</div>
                </div>
                <div class="kpi-pill">
                  <div class="kpi-label">ì´ ìˆ˜ë‚©ê¸ˆì•¡ ëˆ„ê³„ / ìˆ˜ë‚©ìœ¨</div>
                  <div class="kpi-value" id="kpi-detail-collect">82.7 ì–µì› (97.0%)</div>
                </div>
              </div>
            </section>

            <!-- ì •ì±… ë©”ëª¨ ì„¹ì…˜(ì„ íƒ) -->
            <section class="board-card" id="policy-note-section">
              <div class="section-label">Policy Note</div>
              <div class="card-title" style="margin-bottom:6px;">ë‹¹ì›” ì²­êµ¬ê¸ˆì•¡ ì˜ˆì¸¡ ë¡œì§ ìš”ì•½</div>
              <div style="font-size:12px;color:var(--text-sub);line-height:1.7;">
                - ê°€ì…ì ì˜ˆì¸¡: ì¡°íšŒì¼ ê¸°ì¤€ ì§ì „ Nì¼ ê°€ì…ì ìˆ˜ì˜ ì´ë™í‰ê· (MA)ì„ ì‚¬ìš©í•˜ì—¬ ì¡°íšŒì¼+1ì¼ì˜ ê°€ì…ìë¥¼ ì¶”ì •í•˜ê³ , sliding window ë°©ì‹ìœ¼ë¡œ ë‹¹ì›” ë§ê¹Œì§€ ì¼ë³„ ê°€ì…ì ì˜ˆì¸¡ì¹˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.<br/>
                - ì²­êµ¬ê¸ˆì•¡ ì˜ˆì¸¡: ì›” í‰ê·  ê°€ì…ì Ã— ë‹¨ê°€ë¥¼ ì´ìš©í•´ ê³¼ê¸ˆí• ì¸ ì „ ì²­êµ¬ê¸ˆì•¡ì„ ì‚°ì¶œí•œ ë’¤, í•´ë‹¹ ì›”ì— ìœ íš¨í•œ ê³¼ê¸ˆí• ì¸Â·ì²­êµ¬í• ì¸ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš° ì´ë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤.<br/>
                - ì¡°íšŒê¸°ê°„ ì¢…ë£Œì›”ì— â€˜ë‹¹ì›”â€™ì„ ì„ íƒí•œ ê²½ìš°, ìœ„ ì˜ˆì¸¡ ë¡œì§ì„ í™œìš©í•´ â€˜ë‹¹ì›” ì˜ˆìƒ ì²­êµ¬ê¸ˆì•¡â€™ì„ ìš°ì¸¡ ìƒë‹¨ ë°°ì§€ ë˜ëŠ” ë³„ë„ KPIë¡œ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
              </div>
            </section>
          </section>

          <!-- Stub: ë‹¤ë¥¸ ë©”ë‰´ìš© -->
          <section id="stub-container" style="display:none;">
            <div class="stub-card">
              <div class="stub-title" id="stub-title">í™”ë©´ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤</div>
              <p class="stub-desc" id="stub-desc">
                ì„ íƒí•˜ì‹  ë©”ë‰´ì˜ ìƒì„¸ GUIëŠ” ì•„ì§ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br />
                ìš´ì˜ ì •ì±… ë° ìš”êµ¬ì‚¬í•­ ì •ë¦¬ í›„, ìˆœì°¨ì ìœ¼ë¡œ í™”ë©´ì„ êµ¬ì„±í•  ì˜ˆì •ì…ë‹ˆë‹¤.
              </p>
            </div>
          </section>
        </div>
      </div>
    </main>
  </div>

  <script>
    /* =========================
       ë©”ë‰´ êµ¬ì¡° ì •ì˜
    ========================= */
    const MENU_STRUCTURE = {
      "ìƒí’ˆ ìš´ì˜": {
        "ìƒí’ˆ ê´€ë¦¬": ["ìƒí’ˆ ê¸°ì¤€ ì •ë³´"],
        "ê³ ê°ì‚¬ ê´€ë¦¬": ["ê³ ê°ì‚¬ ì •ë³´", "ê³„ì•½ ê´€ë¦¬"],
        "ëŒ€ì‹œë³´ë“œ": ["ì‚¬ì—… ì‹¤ì  ê´€ë¦¬", "í•™ìŠµë°ì´í„° ìˆ˜ì§‘"]
      },
      "ì„œë¹„ìŠ¤ ìš´ì˜": {
        "ì‚¬ìš©ì ê´€ë¦¬": ["ê³„ì • ê´€ë¦¬"],
        "êµ¬ë… ê´€ë¦¬": ["êµ¬ë… í˜„í™©"],
        "DevOps": ["AI ëª¨ë¸"],
        "Support Center": ["ê³µì§€/SOP/FAQ"]
      },
      "ì„œë¹„ìŠ¤ ì •ì‚°": {
        "ì²­êµ¬/ìˆ˜ë‚©": ["ì²­êµ¬/ìˆ˜ë‚©"]
      },
      "ì¼ë°˜": {
        "ì‹œìŠ¤í…œ": ["ë³´ì•ˆ, ì»´í”Œë¼ì´ì–¸ìŠ¤", "ì„¤ì •"]
      }
    };

    const DEFAULT_TOP = "ìƒí’ˆ ìš´ì˜";
    const DEFAULT_L2  = "ëŒ€ì‹œë³´ë“œ";
    const DEFAULT_L3  = "ì‚¬ì—… ì‹¤ì  ê´€ë¦¬";

    let currentTop = DEFAULT_TOP;
    let currentL2  = DEFAULT_L2;
    let currentL3  = DEFAULT_L3;

    let subscribersChart, billingMultiChart, billingDetailChart;
    let currentDetailMode = "both"; // both | recurring | onetime

    document.addEventListener("DOMContentLoaded", () => {
      const topNavItems   = document.querySelectorAll(".top-nav-item");
      const sidebarTitle  = document.querySelector(".sidebar-section-title");
      const sidebarMenuEl = document.getElementById("sidebar-menu");
      const breadcrumbEl  = document.getElementById("breadcrumb");
      const pageTitleEl   = document.getElementById("page-title");

      const perfDashboard = document.getElementById("performance-dashboard");
      const stubContainer = document.getElementById("stub-container");

      const billingMultiSection  = document.getElementById("billing-multi-section");
      const billingDetailSection = document.getElementById("billing-detail-section");
      const btnDetailMode = document.getElementById("btn-detail-mode");
      const btnBackOverview = document.getElementById("btn-back-overview");
      const detailModeButtons = document.querySelectorAll(".chip-toggle[data-detail-mode]");
      const btnExportCsv = document.getElementById("btn-export-csv");
      const btnRunQuery = document.getElementById("btn-run-query");

      const startMonthInput = document.getElementById("start-month");
      const endMonthInput   = document.getElementById("end-month");
      const legendPeriodSub = document.getElementById("legend-period-sub");
      const legendPeriodBill= document.getElementById("legend-period-bill");
      const legendBillType  = document.getElementById("legend-bill-type");
      const chkRecurring    = document.getElementById("bill-type-recurring");
      const chkOnetime      = document.getElementById("bill-type-onetime");

      function setActiveTopNav(label) {
        topNavItems.forEach((item) => {
          const topLabel = item.getAttribute("data-top-label");
          item.classList.toggle("active", topLabel === label);
        });
      }

      function renderSidebar(topLabel, selectedL2, selectedL3) {
        sidebarTitle.textContent = topLabel;
        sidebarMenuEl.innerHTML = "";

        const menus = MENU_STRUCTURE[topLabel] || {};
        Object.keys(menus).forEach((l2Name) => {
          const l3List = menus[l2Name];
          const li = document.createElement("li");
          li.className = "menu-item";
          li.dataset.l2 = l2Name;

          const isActiveL2 = l2Name === selectedL2;
          if (isActiveL2) li.classList.add("active", "open");

          const mainDiv = document.createElement("div");
          mainDiv.className = "menu-main";

          const labelDiv = document.createElement("div");
          labelDiv.className = "menu-label";

          const iconSpan = document.createElement("span");
          iconSpan.className = "menu-icon";
          iconSpan.textContent = "ğŸ“‚";

          const textSpan = document.createElement("span");
          textSpan.textContent = l2Name;

          labelDiv.appendChild(iconSpan);
          labelDiv.appendChild(textSpan);

          const arrowSpan = document.createElement("span");
          arrowSpan.className = "menu-arrow";
          arrowSpan.textContent = "â€º";

          mainDiv.appendChild(labelDiv);
          mainDiv.appendChild(arrowSpan);

          const subUl = document.createElement("ul");
          subUl.className = "submenu-list";

          l3List.forEach((l3Name) => {
            const subLi = document.createElement("li");
            subLi.className = "submenu-item";
            subLi.dataset.l3 = l3Name;
            subLi.textContent = l3Name;

            if (isActiveL2 && l3Name === selectedL3) {
              subLi.classList.add("active");
            }

            subUl.appendChild(subLi);
          });

          li.appendChild(mainDiv);
          li.appendChild(subUl);
          sidebarMenuEl.appendChild(li);
        });
      }

      function updateBreadcrumbAndTitle() {
        breadcrumbEl.innerHTML = "";
        const span1 = document.createElement("span");
        span1.textContent = currentTop;
        const sep1 = document.createElement("span");
        sep1.textContent = "â€º";
        const span2 = document.createElement("span");
        span2.textContent = currentL2;
        const sep2 = document.createElement("span");
        sep2.textContent = "â€º";
        const span3 = document.createElement("span");
        span3.textContent = currentL3;
        span3.className = "current";

        breadcrumbEl.appendChild(span1);
        breadcrumbEl.appendChild(sep1);
        breadcrumbEl.appendChild(span2);
        breadcrumbEl.appendChild(sep2);
        breadcrumbEl.appendChild(span3);

        if (currentTop === "ìƒí’ˆ ìš´ì˜" && currentL2 === "ëŒ€ì‹œë³´ë“œ" && currentL3 === "ì‚¬ì—… ì‹¤ì  ê´€ë¦¬") {
          pageTitleEl.textContent = "ì‚¬ì—… ì‹¤ì  ê´€ë¦¬ (ì‹¤ì  ì¢…í•©)";
        } else {
          pageTitleEl.textContent = currentL2;
        }
      }

      function isPerformancePage() {
        return (
          currentTop === "ìƒí’ˆ ìš´ì˜" &&
          currentL2 === "ëŒ€ì‹œë³´ë“œ" &&
          currentL3 === "ì‚¬ì—… ì‹¤ì  ê´€ë¦¬"
        );
      }

      function renderPage() {
        if (isPerformancePage()) {
          perfDashboard.style.display = "";
          stubContainer.style.display = "none";
        } else {
          perfDashboard.style.display = "none";
          stubContainer.style.display = "";
          const stubTitle = document.getElementById("stub-title");
          const stubDesc  = document.getElementById("stub-desc");
          stubTitle.textContent = `${currentTop} - ${currentL2} (${currentL3})`;
          stubDesc.textContent  = "í•´ë‹¹ ë©”ë‰´ëŠ” í˜„ì¬ ì‚¬ì—… ì‹¤ì  ê´€ë¦¬ ì´ì™¸ì˜ ê¸°ëŠ¥ìœ¼ë¡œ, ìƒì„¸ GUIëŠ” ì¶”í›„ êµ¬ì„±ë  ì˜ˆì •ì…ë‹ˆë‹¤.";
        }
        updateBreadcrumbAndTitle();
      }

      /* ========== Chart ìƒ˜í”Œ ë°ì´í„° ========== */
      const labels = ["2025-01","2025-02","2025-03","2025-04","2025-05","2025-06","2025-07","2025-08","2025-09","2025-10","2025-11","2025-12"];

      const subsData = [11800,12150,12300,12450,12500,12600,12750,13200,13100,12950,12800,12700];

      const recurringBill = [5.8,6.1,6.3,6.5,6.6,6.7,6.9,7.1,7.2,7.3,7.4,7.5];
      const onetimeBill   = [0.4,0.0,0.8,0.0,0.6,0.0,1.1,3.6,0.0,1.2,1.0,2.1];
      const totalBill     = recurringBill.map((v,i)=>Number((v + onetimeBill[i]).toFixed(1)));
      const collectedBill = totalBill.map(v => Number((v * 0.97).toFixed(1)));
      const totalDiscount = recurringBill.map(v => Number((v * 0.12).toFixed(1))); // ì˜ˆì‹œ: 12% í• ì¸
      const preDiscount   = recurringBill.map((v,i)=> Number((v + totalDiscount[i]).toFixed(1)));

      function sum(arr) {
        return arr.reduce((a,b)=>a+b,0);
      }

      /* ========== Chart ì´ˆê¸°í™” í•¨ìˆ˜ ========== */
      function initSubscribersChart() {
        const ctx = document.getElementById("subscribersChart").getContext("2d");
        if (subscribersChart) subscribersChart.destroy();
        subscribersChart = new Chart(ctx, {
          type: "line",
          data: {
            labels,
            datasets: [
              {
                label: "ì›” í‰ê·  ê°€ì…ììˆ˜ (Maxis)",
                data: subsData,
                fill: true,
                borderColor: "#7c3aed",
                backgroundColor: "rgba(124,58,237,0.18)",
                tension: 0.3,
                pointRadius: 3
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: { mode: "index", intersect: false }
            },
            scales: {
              x: {
                grid: { display: false }
              },
              y: {
                ticks: {
                  callback: (value) => value.toLocaleString("ko-KR") + "ëª…"
                }
              }
            }
          }
        });

        // KPI ì—…ë°ì´íŠ¸
        const avg = sum(subsData) / subsData.length;
        const max = Math.max(...subsData);
        const min = Math.min(...subsData);
        document.getElementById("kpi-sub-avg").textContent = Math.round(avg).toLocaleString("ko-KR") + " ëª…";
        document.getElementById("kpi-sub-max").textContent = max.toLocaleString("ko-KR") + " ëª…";
        document.getElementById("kpi-sub-min").textContent = min.toLocaleString("ko-KR") + " ëª…";
      }

      function initBillingMultiChart() {
        const ctx = document.getElementById("billingMultiChart").getContext("2d");
        if (billingMultiChart) billingMultiChart.destroy();
        billingMultiChart = new Chart(ctx, {
          type: "line",
          data: {
            labels,
            datasets: [
              {
                label: "ì´ ì²­êµ¬ê¸ˆì•¡ (Maxis)",
                data: totalBill,
                fill: true,
                borderColor: "#ec4899",
                backgroundColor: "rgba(236,72,153,0.18)",
                tension: 0.3,
                pointRadius: 3
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: { mode: "index", intersect: false }
            },
            scales: {
              x: { grid: { display: false } },
              y: {
                ticks: {
                  callback: (value) => value + "ì–µ"
                }
              }
            },
            onClick: () => {
              // ì‹¤ì œ êµ¬í˜„ ì‹œ: íŠ¹ì • ê³ ê°ì‚¬ í´ë¦­ â†’ Detail ëª¨ë“œ ì „í™˜
              enterDetailMode();
            }
          }
        });

        const total = sum(totalBill);
        const rec   = sum(recurringBill);
        const one   = sum(onetimeBill);
        const coll  = sum(collectedBill);
        document.getElementById("kpi-bill-total").textContent = total.toFixed(1) + " ì–µì›";
        document.getElementById("kpi-bill-rec").textContent   = rec.toFixed(1)   + " ì–µì›";
        document.getElementById("kpi-bill-one").textContent   = one.toFixed(1)   + " ì–µì›";
        document.getElementById("kpi-bill-collect").textContent = coll.toFixed(1) + " ì–µì› (97.0%)";
      }

      function initBillingDetailChart() {
        const ctx = document.getElementById("billingDetailChart").getContext("2d");
        if (billingDetailChart) billingDetailChart.destroy();

        if (currentDetailMode === "onetime") {
          // (a) ì¼íšŒì„± ëª¨ë“œ: ì¼íšŒì„± ì²­êµ¬ + í¬ë ˆë”§ ì”ì•¡(ìŒìˆ˜) ëˆ„ì  ë§‰ëŒ€
          const creditBalance = onetimeBill.map((v,i)=> Number((-v * 0.3).toFixed(1))); // ì˜ˆì‹œ: í¬ë ˆë”§ ì”ì•¡ ìŒìˆ˜ í‘œí˜„
          billingDetailChart = new Chart(ctx, {
            type: "bar",
            data: {
              labels,
              datasets: [
                {
                  label: "ì¼íšŒì„± ì²­êµ¬ê¸ˆì•¡",
                  data: onetimeBill,
                  backgroundColor: "#f97373",
                  stack: "one"
                },
                {
                  label: "í¬ë ˆë”§ ì”ì•¡(ìŒìˆ˜í‘œí˜„)",
                  data: creditBalance,
                  backgroundColor: "#60a5fa",
                  stack: "one"
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { position: "top" },
                tooltip: { mode: "index", intersect: false }
              },
              scales: {
                x: { stacked: true },
                y: {
                  stacked: true,
                  ticks: {
                    callback: (value)=> value + "ì–µ"
                  }
                }
              },
              onClick: () => {
                // í´ë¦­ ì‹œ ìš°ì¸¡ íŒ¨ë„ ë‚´ìš© ì—…ë°ì´íŠ¸í•˜ëŠ” ê³µê°„
              }
            }
          });
        } else if (currentDetailMode === "recurring") {
          // (b) ë°˜ë³µì„± ëª¨ë“œ: ëˆ„ì  ë§‰ëŒ€(ê³¼ê¸ˆ ì „ / í• ì¸ / ë°˜ë³µì„± ì²­êµ¬) + êº¾ì€ì„ (ë°˜ë³µì„±)
          billingDetailChart = new Chart(ctx, {
            data: {
              labels,
              datasets: [
                {
                  type: "bar",
                  label: "ì´ ê³¼ê¸ˆê¸ˆì•¡(í• ì¸ ì „)",
                  data: preDiscount,
                  backgroundColor: "rgba(37,99,235,0.4)",
                  stack: "stack1"
                },
                {
                  type: "bar",
                  label: "ì´ í• ì¸ê¸ˆì•¡",
                  data: totalDiscount.map(v=>-v),
                  backgroundColor: "rgba(248,113,113,0.7)",
                  stack: "stack1"
                },
                {
                  type: "bar",
                  label: "ë°˜ë³µì„± ì²­êµ¬ê¸ˆì•¡",
                  data: recurringBill,
                  backgroundColor: "rgba(34,197,94,0.7)",
                  stack: "stack1"
                },
                {
                  type: "line",
                  label: "ë°˜ë³µì„± ì²­êµ¬ê¸ˆì•¡ (Line)",
                  data: recurringBill,
                  borderColor: "#22c55e",
                  backgroundColor: "#22c55e",
                  tension: 0.3,
                  yAxisID: "y"
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { position: "top" }
              },
              scales: {
                x: { stacked: true },
                y: {
                  stacked: true,
                  ticks: {
                    callback: (value)=> value + "ì–µ"
                  }
                }
              }
            }
          });
        } else {
          // (c) ì „ì²´ ëª¨ë“œ: ì´ ì²­êµ¬ / ë°˜ë³µì„± / ì¼íšŒì„± / ì´ ìˆ˜ë‚©ê¸ˆì•¡(ê·¸ë£¹í˜• ë§‰ëŒ€)
          billingDetailChart = new Chart(ctx, {
            type: "bar",
            data: {
              labels,
              datasets: [
                {
                  label: "ì´ ì²­êµ¬ê¸ˆì•¡",
                  data: totalBill,
                  backgroundColor: "#a855f7"
                },
                {
                  label: "ë°˜ë³µì„± ì²­êµ¬ê¸ˆì•¡",
                  data: recurringBill,
                  backgroundColor: "#22c55e"
                },
                {
                  label: "ì¼íšŒì„± ì²­êµ¬ê¸ˆì•¡",
                  data: onetimeBill,
                  backgroundColor: "#f97373"
                },
                {
                  label: "ì´ ìˆ˜ë‚©ê¸ˆì•¡",
                  data: collectedBill,
                  backgroundColor: "#38bdf8"
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { position: "top" },
                tooltip: { mode: "index", intersect: false }
              },
              scales: {
                x: {
                  stacked: false
                },
                y: {
                  stacked: false,
                  ticks: {
                    callback: (value)=> value + "ì–µ"
                  }
                }
              }
            }
          });
        }

        // Detail KPIëŠ” Overviewì™€ ë™ì¼ ìƒ˜í”Œ ê°’ ì‚¬ìš©
        const total = sum(totalBill);
        const rec   = sum(recurringBill);
        const one   = sum(onetimeBill);
        const coll  = sum(collectedBill);
        document.getElementById("kpi-detail-total").textContent   = total.toFixed(1) + " ì–µì›";
        document.getElementById("kpi-detail-rec").textContent     = rec.toFixed(1)   + " ì–µì›";
        document.getElementById("kpi-detail-one").textContent     = one.toFixed(1)   + " ì–µì›";
        document.getElementById("kpi-detail-collect").textContent = coll.toFixed(1) + " ì–µì› (97.0%)";
      }

      function enterDetailMode() {
        billingMultiSection.style.display  = "none";
        billingDetailSection.style.display = "";
        currentDetailMode = "both";
        detailModeButtons.forEach(btn => {
          btn.classList.toggle("active", btn.dataset.detailMode === "both");
        });
        initBillingDetailChart();
      }

      function backToOverview() {
        billingMultiSection.style.display  = "";
        billingDetailSection.style.display = "none";
      }

      /* ========== ì´ë²¤íŠ¸ ë°”ì¸ë”© ========== */
      setActiveTopNav(DEFAULT_TOP);
      renderSidebar(DEFAULT_TOP, DEFAULT_L2, DEFAULT_L3);
      renderPage();
      initSubscribersChart();
      initBillingMultiChart();

      // Top Nav
      topNavItems.forEach(item => {
        item.addEventListener("click", () => {
          const label = item.getAttribute("data-top-label");
          currentTop = label;
          const l2List = Object.keys(MENU_STRUCTURE[label] || {});
          currentL2 = l2List[0] || "";
          const l3List = (MENU_STRUCTURE[label] || {})[currentL2] || [];
          currentL3 = l3List[0] || "";

          setActiveTopNav(label);
          renderSidebar(currentTop, currentL2, currentL3);
          renderPage();
        });
      });

      // Sidebar
      sidebarMenuEl.addEventListener("click", (e) => {
        const menuMain = e.target.closest(".menu-main");
        const submenu  = e.target.closest(".submenu-item");

        if (menuMain) {
          const li = menuMain.parentElement;
          if (li.classList.contains("open")) {
            li.classList.remove("open");
          } else {
            sidebarMenuEl.querySelectorAll(".menu-item").forEach(mi => {
              mi.classList.toggle("open", mi === li);
            });
          }
        }

        if (submenu) {
          const l2 = submenu.closest(".menu-item").dataset.l2;
          const l3 = submenu.dataset.l3;

          currentL2 = l2;
          currentL3 = l3;

          sidebarMenuEl.querySelectorAll(".menu-item").forEach(mi => {
            mi.classList.toggle("active", mi.dataset.l2 === l2);
          });
          sidebarMenuEl.querySelectorAll(".submenu-item").forEach(si => {
            si.classList.toggle("active", si === submenu);
          });

          renderPage();
        }
      });

      // ì¡°íšŒ ë²„íŠ¼ â†’ ê¸°ê°„/ìœ í˜•ì— ë§ê²Œ ë ˆì´ë¸”ë§Œ ì—…ë°ì´íŠ¸ (ìƒ˜í”Œ)
      btnRunQuery.addEventListener("click", () => {
        const s = startMonthInput.value || "2025-01";
        const e = endMonthInput.value   || "2025-12";
        const [sy,sm] = s.split("-");
        const [ey,em] = e.split("-");
        const periodLabel = `${sy}.${sm} ~ ${ey}.${em}`;

        legendPeriodSub.textContent  = periodLabel;
        legendPeriodBill.textContent = periodLabel;

        const types = [];
        if (chkRecurring.checked) types.push("ë°˜ë³µì„±");
        if (chkOnetime.checked)   types.push("ì¼íšŒì„±");
        legendBillType.textContent = types.length === 2 ? "ë°˜ë³µì„± + ì¼íšŒì„±" : (types[0] || "ìœ í˜• ì—†ìŒ");

        // ì‹¤ì œ êµ¬í˜„ ì‹œ ì—¬ê¸°ì„œ APIë¥¼ í˜¸ì¶œí•˜ì—¬ ì°¨íŠ¸ ë°ì´í„°ë¥¼ ì¬ê³„ì‚°Â·ì¬ë Œë”ë§
        initSubscribersChart();
        initBillingMultiChart();
        if (billingDetailSection.style.display !== "none") {
          initBillingDetailChart();
        }
      });

      // Detail ëª¨ë“œ ì „í™˜ ë²„íŠ¼
      btnDetailMode.addEventListener("click", enterDetailMode);
      btnBackOverview.addEventListener("click", backToOverview);

      // Detail ëª¨ë“œ í† ê¸€ ë²„íŠ¼
      detailModeButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const mode = btn.dataset.detailMode;
          currentDetailMode = mode;
          detailModeButtons.forEach(b => {
            b.classList.toggle("active", b === btn);
          });
          initBillingDetailChart();
        });
      });

      // CSV ë‹¤ìš´ë¡œë“œ (ìƒ˜í”Œ)
      btnExportCsv.addEventListener("click", () => {
        alert("í˜„ì¬ ê·¸ë˜í”„ì— í‘œì‹œëœ ë°ì´í„°ì…‹ì„ CSVë¡œ ë‚´ë³´ë‚´ëŠ” ê¸°ëŠ¥ì€ ë°±ì—”ë“œ/í”„ë¡ íŠ¸ ì—°ë™ ì‹œ êµ¬í˜„í•©ë‹ˆë‹¤. (UI ìŠ¤ì¼ˆë ˆí†¤)");
      });
    });
  </script>
</body>
</html>
